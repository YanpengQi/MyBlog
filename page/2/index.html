<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-big-counter.min.css?v=1.0.2">















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false,"dimmer":true},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Notes of study, work and life">
<meta property="og:type" content="website">
<meta property="og:title" content="Anda">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Anda">
<meta property="og:description" content="Notes of study, work and life">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Anda">
<meta name="twitter:description" content="Notes of study, work and life">





  
  
  <link rel="canonical" href="http://yoursite.com/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Anda</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Anda</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Notes of study, work and life</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">22</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">2</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">26</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/Luorinz" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/17/[Notes] Simple Recommendation System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/17/[Notes] Simple Recommendation System/" class="post-title-link" itemprop="url">[Notes] Simple Recommendation System</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-17 20:06:05 / Modified: 13:07:34" itemprop="dateCreated datePublished" datetime="2019-04-17T20:06:05-07:00">2019-04-17</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">9.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">8 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Continue-to-implement-get-history"><a href="#Continue-to-implement-get-history" class="headerlink" title="Continue to implement get history"></a>Continue to implement get history</h1><h2 id="Implement-getFavoriteItemsmethod"><a href="#Implement-getFavoriteItemsmethod" class="headerlink" title="Implement getFavoriteItemsmethod"></a>Implement getFavoriteItemsmethod</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Get the favorite items given userId in the history table</span></span><br><span class="line"><span class="comment">    * userId -&gt; itemId -&gt; favorite items</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Item&gt; <span class="title">getFavoriteItems</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;Item&gt;();</span><br><span class="line">    Set&lt;Item&gt; favoriteItems = <span class="keyword">new</span> HashSet&lt;Item&gt;();</span><br><span class="line">    Set&lt;String&gt; itemIds = getFavoriteItemIds(userId);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String sql = <span class="string">"SELECT * FROM items WHERE item_id = ?"</span>;</span><br><span class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</span><br><span class="line">        <span class="keyword">for</span> (String itemId: itemIds) &#123;</span><br><span class="line">            stmt.setString(<span class="number">1</span>, itemId);</span><br><span class="line">            <span class="comment">// executeQuery returns a table(ResultSet)</span></span><br><span class="line">            ResultSet res = stmt.executeQuery();</span><br><span class="line">            ItemBuilder builder = <span class="keyword">new</span> ItemBuilder();</span><br><span class="line">            <span class="comment">// iterator</span></span><br><span class="line">            <span class="keyword">while</span> (res.next()) &#123;</span><br><span class="line">                builder.setItemId(res.getString(<span class="string">"item_id"</span>));</span><br><span class="line">                builder.setName(res.getString(<span class="string">"name"</span>));</span><br><span class="line">                builder.setAddress(res.getString(<span class="string">"address"</span>));</span><br><span class="line">                builder.setImageUrl(res.getString(<span class="string">"image_url"</span>));</span><br><span class="line">                builder.setUrl(res.getString(<span class="string">"url"</span>));</span><br><span class="line">                builder.setCategories(getCategories(itemId));</span><br><span class="line">                builder.setDistance(res.getDouble(<span class="string">"distance"</span>));</span><br><span class="line">                builder.setRating(res.getDouble(<span class="string">"rating"</span>));</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                favoriteItems.add(builder.build());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> favoriteItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Next-let’s-try-getFavoriteItemIds-and-getCategories"><a href="#Next-let’s-try-getFavoriteItemIds-and-getCategories" class="headerlink" title="Next, let’s try getFavoriteItemIds and getCategories"></a>Next, let’s try getFavoriteItemIds and getCategories</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Given userId, query history table, get corresponding item_id.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getFavoriteItemIds</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">    Set&lt;String&gt; favoriteItemIds = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String sql = <span class="string">"SELECT * FROM history WHERE user_id = ?"</span>;</span><br><span class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</span><br><span class="line">        stmt.setString(<span class="number">1</span>, userId);</span><br><span class="line">        ResultSet res = stmt.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (res.next()) &#123;</span><br><span class="line">            favoriteItemIds.add(res.getString(<span class="string">"item_id"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> favoriteItemIds;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Given itemId, query categories table, get corresponding categories</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getCategories</span><span class="params">(String itemId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    Set&lt;String&gt; categories = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String sql = <span class="string">"SELECT category FROM categories WHERE item_id = ?"</span>;</span><br><span class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</span><br><span class="line">        stmt.setString(<span class="number">1</span>, itemId);</span><br><span class="line">        ResultSet res = stmt.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (res.next()) &#123;</span><br><span class="line">            categories.add(res.getString(<span class="string">"category"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> categories;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Get-back-to-ItemHistory-java-update-doGet-method"><a href="#Get-back-to-ItemHistory-java-update-doGet-method" class="headerlink" title="Get back to ItemHistory.java, update doGet method."></a>Get back to <code>ItemHistory.java</code>, update <code>doGet</code> method.</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Get the user_id from request, query the favorite items, and handle the response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String userId = request.getParameter(<span class="string">"user_id"</span>);</span><br><span class="line">    JSONArray array = <span class="keyword">new</span> JSONArray();</span><br><span class="line">    </span><br><span class="line">    DBConnection conn = DBConnectionFactory.getConnection();</span><br><span class="line">    Set&lt;Item&gt; items = conn.getFavoriteItems(userId);</span><br><span class="line">    <span class="keyword">for</span> (Item item: items) &#123;</span><br><span class="line">        JSONObject obj = item.toJSONObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj.append(<span class="string">"favorite"</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        array.put(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    RpcHelper.writeJSONArray(response, array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="test-with-http-localhost-8080-Jupiter-history-user-id-1111"><a href="#test-with-http-localhost-8080-Jupiter-history-user-id-1111" class="headerlink" title="test with http://localhost:8080/Jupiter/history?user_id=1111"></a>test with <a href="http://localhost:8080/Jupiter/history?user_id=1111" target="_blank" rel="noopener">http://localhost:8080/Jupiter/history?user_id=1111</a></h2><h1 id="Recommendation-System"><a href="#Recommendation-System" class="headerlink" title="Recommendation System"></a>Recommendation System</h1><p>Widely exists in industry and it is a popular interview question. </p>
<p>Facebook: news feed, friends, ‘Do you know this friend?’的例子</p>
<p>LinkedIn: jobs, companies, acquaintances, ‘Are you interested in this job?’的例子</p>
<p>Amazon: 电饭锅的例子</p>
<p>Google Ads: 两颗红豆的例子</p>
<h2 id="Engineering-Design"><a href="#Engineering-Design" class="headerlink" title="Engineering Design"></a>Engineering Design</h2><ol>
<li><p>Given a user, fetch all the events (ids) this user has visited. (which table? which API?)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//history: history_id, user_id, item_id, last_favor_time.</span></span><br><span class="line">Set&lt;String&gt; itemIds = getFavoriteItemIds(userId);</span><br></pre></td></tr></table></figure>
</li>
<li><p>given all these events, what are the categories? (which table? which API?)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//categories: item_id, category.</span></span><br><span class="line">Set&lt;String&gt; categories = getCategories(itemId);</span><br></pre></td></tr></table></figure>
</li>
<li><p>given these categories, what are the events that belong to them (which table? which API?)</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//external API</span></span><br><span class="line">List&lt;Item&gt; items = searchItems(userId, lat, lon, category);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>filter events that this user has visited</li>
</ol>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/12.%20Simple%20Recommendation%20System-2019-4-17-11-58-6.png" alt="12. Simple Recommendation System-2019-4-17-11-58-6.png"></p>
<h2 id="Code-Implementation"><a href="#Code-Implementation" class="headerlink" title="Code Implementation"></a>Code Implementation</h2><h3 id="Add-a-new-package-src-algorithm-Add-GeoRecommendation-java"><a href="#Add-a-new-package-src-algorithm-Add-GeoRecommendation-java" class="headerlink" title="Add a new package src/algorithm. Add GeoRecommendation.java."></a>Add a new package <code>src/algorithm</code>. Add <code>GeoRecommendation.java</code>.</h3><blockquote>
<p>Idea of this algorithm: First get the current user’s favourite items, then get all categories of this user’s favorites, sort them by descending order. Then get these categories, search items again, sort this items with distance(Ascending order), and add those items to the result. Category &gt; Distance.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">recommendItems</span><span class="params">(String userId, <span class="keyword">double</span> lat, <span class="keyword">double</span> lon)</span> </span>&#123;</span><br><span class="line">    List&lt;Item&gt; recommendedItems = <span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line">    DBConnection conn = DBConnectionFactory.getConnection();</span><br><span class="line">    <span class="comment">// 1. Get all favorite itemIds</span></span><br><span class="line">    Set&lt;String&gt; favoriteItemIds = conn.getFavoriteItemIds(userId);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. Get all categories by favorite items, sort by count</span></span><br><span class="line">    <span class="comment">// Use a map to store category and its counts</span></span><br><span class="line">    Map&lt;String, Integer&gt; allCategories = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String itemId: favoriteItemIds) &#123;</span><br><span class="line">        Set&lt;String&gt; categories = conn.getCategories(itemId);</span><br><span class="line">        <span class="keyword">for</span> (String category: categories) &#123;</span><br><span class="line">            allCategories.put(category, allCategories.getOrDefault(category, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Sort the category</span></span><br><span class="line">    <span class="comment">// avoid integer overflow, Use Integer.compare(int, int)</span></span><br><span class="line">    List&lt;Entry&lt;String, Integer&gt;&gt; categoryList = <span class="keyword">new</span> ArrayList&lt;&gt;(allCategories.entrySet());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// more occurrences first</span></span><br><span class="line">    Collections.sort(categoryList, <span class="keyword">new</span> Comparator&lt;Entry&lt;String, Integer&gt;&gt;(</span><br><span class="line">            ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Entry&lt;String, Integer&gt; o1, Entry&lt;String, Integer&gt; o2)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> Integer.compare(o2.getValue(), o1.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. do search based on category, filter out favorite events, sort by distance</span></span><br><span class="line">    </span><br><span class="line">    Set&lt;Item&gt; visitedItems = <span class="keyword">new</span> HashSet&lt;Item&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;String ,Integer&gt; category: categoryList) &#123;</span><br><span class="line">        List&lt;Item&gt; items = conn.searchItems(lat, lon, category.getKey());</span><br><span class="line">        List&lt;Item&gt; filteredItems = <span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Item item: items) &#123;</span><br><span class="line">            <span class="comment">// if not visited again and not already in the favorite list, add to recommendation list</span></span><br><span class="line">            <span class="keyword">if</span> (!favoriteItemIds.contains(item.getItemId()) &amp;&amp; !visitedItems.contains(item)) &#123;</span><br><span class="line">                filteredItems.add(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// sort the items in filtered items. less distance first</span></span><br><span class="line">        Collections.sort(filteredItems, <span class="keyword">new</span> Comparator&lt;Item&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Item o1, Item o2)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Double.compare(o1.getDistance(), o2.getDistance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        visitedItems.addAll(items);</span><br><span class="line">        recommendedItems.addAll(filteredItems);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> recommendedItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Step-2-Go-to-src-rpc-RecommendItem-java-implement-doGet-method"><a href="#Step-2-Go-to-src-rpc-RecommendItem-java-implement-doGet-method" class="headerlink" title="Step 2, Go to src/rpc/RecommendItem.java, implement doGet()method."></a>Step 2, Go to <code>src/rpc/RecommendItem.java</code>, implement <code>doGet()</code>method.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Get the lat and lon and current userId, return a list of recommended items</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String userId = request.getParameter(<span class="string">"user_id"</span>);</span><br><span class="line">    <span class="keyword">double</span> lat = Double.parseDouble(request.getParameter(<span class="string">"lat"</span>));</span><br><span class="line">    <span class="keyword">double</span> lon = Double.parseDouble(request.getParameter(<span class="string">"lon"</span>));</span><br><span class="line">    </span><br><span class="line">    GeoRecommendation recommendation = <span class="keyword">new</span> GeoRecommendation();</span><br><span class="line">    List&lt;Item&gt; items = recommendation.recommendItems(userId, lat, lon);</span><br><span class="line">    </span><br><span class="line">    JSONArray result = <span class="keyword">new</span> JSONArray();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(Item item: items) &#123;</span><br><span class="line">            result.put(item.toJSONObject());				</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    RpcHelper.writeJSONArray(response, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Step-3-De-duplicate-items-in-recommendation-results"><a href="#Step-3-De-duplicate-items-in-recommendation-results" class="headerlink" title="Step 3, De-duplicate items in recommendation results."></a>Step 3, De-duplicate items in recommendation results.</h3><p>Since we’re using set to save results from our recommendation function, we need do the de-duplication based on <code>item_id</code>. So go to <code>Item.java</code>, add <code>hashCode()</code> and <code>equals()</code>. </p>
<p>Eclipse provides an easy way to add this two methods. Careful, only select <code>itemId</code> when generating these methods.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/16/[Notes] JavaScript Basic 2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/16/[Notes] JavaScript Basic 2/" class="post-title-link" itemprop="url">[Notes] JavaScript Basic 2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-16 23:51:09 / Modified: 16:51:57" itemprop="dateCreated datePublished" datetime="2019-04-16T23:51:09-07:00">2019-04-16</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">3.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">3 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Scope-chain"><a href="#Scope-chain" class="headerlink" title="Scope chain"></a>Scope chain</h1><p>In JavaScript there are two types of scope:</p>
<ul>
<li>Local scope</li>
<li>Global scope<br>JavaScript has function scope: Each function creates a new scope.</li>
</ul>
<p>Scope determines the accessibility (visibility) of these variables.</p>
<p>Variables defined inside a function are not accessible (visible) from outside the function.</p>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-14-55-3.png" alt="11. JavaScript Basic 2-2019-4-16-14-55-3.png"></p>
<h2 id="Scope-chain-1"><a href="#Scope-chain-1" class="headerlink" title="Scope chain"></a>Scope chain</h2><p>The scope chain property of each execution context is simply a collection of the current context variable object + all parent’s lexical variable objects.</p>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-14-55-8.png" alt="11. JavaScript Basic 2-2019-4-16-14-55-8.png"></p>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-15-12-31.png" alt="11. JavaScript Basic 2-2019-4-16-15-12-31.png"></p>
<h1 id="this-in-JavaScript"><a href="#this-in-JavaScript" class="headerlink" title="this in JavaScript"></a>this in JavaScript</h1><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-14-56-38.png" alt="11. JavaScript Basic 2-2019-4-16-14-56-38.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.a = <span class="number">19</span>;</span><br><span class="line"><span class="comment">// window is a father object in JS</span></span><br><span class="line"><span class="comment">// 如果函数调用中没指定当前是类还是函数（是否有new），this默认指window</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a'</span> <span class="keyword">in</span> <span class="built_in">window</span>);  <span class="comment">// return true</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h1><h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><p>A closure is a function having access to the parent scope, even after the parent function has closed.</p>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-15-34-31.png" alt="11. JavaScript Basic 2-2019-4-16-15-34-31.png"></p>
<blockquote>
<p>Closure here includes the annonymous function and the local variable arg. Here the local variable won’t be released even add() is ended.</p>
</blockquote>
<p>examples:<br><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-15-45-18.png" alt="11. JavaScript Basic 2-2019-4-16-15-45-18.png"></p>
<h1 id="BOM-amp-DOM"><a href="#BOM-amp-DOM" class="headerlink" title="BOM &amp; DOM"></a>BOM &amp; DOM</h1><h2 id="BOM"><a href="#BOM" class="headerlink" title="BOM"></a>BOM</h2><p>There are no official standards for the <code>Browser Object Model (BOM)</code>.<br>Since modern browsers have implemented (almost) the same methods and properties for JavaScript interactivity, it is often referred to, as methods and properties of the <code>BOM</code>.</p>
<p>The <code>BOM</code> (<code>Browser Object Model</code>) consists of the <code>objects navigator</code>, <code>history</code>,<code>screen</code>, <code>location</code> and <code>document</code> which are children of window</p>
<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><p>The <code>Document Object Model (DOM)</code> connects web pages to scripts or programming languages. Usually that means <code>JavaScript</code>. The <code>DOM</code> model represents a document with a logical tree. <code>DOM</code> methods allow programmatic access to the tree; with them you can change the document’s structure, style or content. <code>DOM</code> nodes can have event handlers attached to them. Once an event is triggered, the event handlers get executed.</p>
<h3 id="Document-Object"><a href="#Document-Object" class="headerlink" title="Document Object"></a>Document Object</h3><ul>
<li>When an HTML document is loaded into a web browser, it becomes a document object.</li>
<li>The document object is the root node of the HTML document.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-15-58-16.png" alt="11. JavaScript Basic 2-2019-4-16-15-58-16.png"></p>
<h3 id="Finding-HTML-Elements"><a href="#Finding-HTML-Elements" class="headerlink" title="Finding HTML Elements"></a>Finding HTML Elements</h3><table>
<thead>
<tr>
<th style="text-align:center">Method</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">document.getElementById(id)</td>
<td style="text-align:center">Find an element by element id</td>
</tr>
<tr>
<td style="text-align:center">document.getElementsByTagName(name)</td>
<td style="text-align:center">Find elements by tag name</td>
</tr>
<tr>
<td style="text-align:center">document.getElementsByClassName(name)</td>
<td style="text-align:center">Find elements by class name</td>
</tr>
</tbody>
</table>
<h3 id="Changing-HTML-Elements"><a href="#Changing-HTML-Elements" class="headerlink" title="Changing HTML Elements"></a>Changing HTML Elements</h3><table>
<thead>
<tr>
<th style="text-align:center">Method</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">element.innerHTML =  new html content</td>
<td style="text-align:center">Change the inner HTML of an element</td>
</tr>
<tr>
<td style="text-align:center">element.attribute = new value</td>
<td style="text-align:center">Change the attribute value of an HTML element</td>
</tr>
<tr>
<td style="text-align:center">element.setAttribute(attribute, value)</td>
<td style="text-align:center">Change the attribute value of an HTML element</td>
</tr>
<tr>
<td style="text-align:center">element.style.property = new style</td>
<td style="text-align:center">Change the style of an HTML element</td>
</tr>
</tbody>
</table>
<h3 id="Adding-and-Deleting-Elements"><a href="#Adding-and-Deleting-Elements" class="headerlink" title="Adding and Deleting Elements"></a>Adding and Deleting Elements</h3><table>
<thead>
<tr>
<th style="text-align:center">Method</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">document.createElement(element)</td>
<td style="text-align:center">Create an HTML element</td>
</tr>
<tr>
<td style="text-align:center">document.removeChild(element)</td>
<td style="text-align:center">Remove an HTML element</td>
</tr>
<tr>
<td style="text-align:center">document.appendChild(element)</td>
<td style="text-align:center">Add an HTML element</td>
</tr>
<tr>
<td style="text-align:center">document.replaceChild(element)</td>
<td style="text-align:center">Replace an HTML element</td>
</tr>
<tr>
<td style="text-align:center">document.write(text)</td>
<td style="text-align:center">Write into the HTML output stream</td>
</tr>
</tbody>
</table>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-16-6-14.png" alt="11. JavaScript Basic 2-2019-4-16-16-6-14.png"></p>
<h1 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h1><ol>
<li><code>Capturing phase</code> – the event goes down to the element.</li>
<li><code>Bubbling phase</code> – the event bubbles up from the element.<br><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-16-7-19.png" alt="11. JavaScript Basic 2-2019-4-16-16-7-19.png"></li>
</ol>
<h2 id="DOM0-onclick"><a href="#DOM0-onclick" class="headerlink" title="DOM0 - onclick"></a>DOM0 - onclick</h2><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-16-20-12.png" alt="11. JavaScript Basic 2-2019-4-16-16-20-12.png"></p>
<blockquote>
<p>Don’t write JS code inline.</p>
</blockquote>
<h2 id="DOM2-addEventListener"><a href="#DOM2-addEventListener" class="headerlink" title="DOM2 - addEventListener"></a>DOM2 - addEventListener</h2><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-16-31-8.png" alt="11. JavaScript Basic 2-2019-4-16-16-31-8.png"></p>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-16-31-24.png" alt="11. JavaScript Basic 2-2019-4-16-16-31-24.png"></p>
<blockquote>
<p> 捕获阶段与冒泡阶段区别在于谁先触发</p>
</blockquote>
<p>Example:</p>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/11.%20JavaScript%20Basic%202-2019-4-16-16-40-14.png" alt="11. JavaScript Basic 2-2019-4-16-16-40-14.png"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/16/[Notes] MySQL Basic 2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/16/[Notes] MySQL Basic 2/" class="post-title-link" itemprop="url">[Notes] MySQL Basic 2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-16 21:27:17 / Modified: 14:29:55" itemprop="dateCreated datePublished" datetime="2019-04-16T21:27:17-07:00">2019-04-16</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">9.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">8 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Save-search-results-to-database"><a href="#Save-search-results-to-database" class="headerlink" title="Save search results to database"></a>Save search results to database</h1><ol>
<li>Under <code>db.mysql</code> package, create class/<code>MySQLConnection.java</code>. </li>
<li>Implement <code>DBConnection</code> interface</li>
<li>Implement both <code>close</code> method and <code>constructor</code>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// connection</span></span><br><span class="line"><span class="keyword">private</span> Connection conn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// constructor</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MySQLConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>).newInstance();</span><br><span class="line">        conn = DriverManager.getConnection(MySQLDBUtil.URL);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * close the connection</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>implement <code>searchItems()</code> in <code>MySQLConnection</code>. Previously we call <code>TicketMasterAPI.search</code> from our <code>SearchItem</code> servlet directly. But actually our recommendation code also needs to call the same search function, so we make a designated function here to do the search call.<br>The code is simply copied from what we’ve already had in <code>SearchItem.java</code>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Search Item. Same as TMAPI search item.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">searchItems</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon, String term)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Get the items from TM</span></span><br><span class="line">    TicketMasterAPI tmAPI = <span class="keyword">new</span> TicketMasterAPI();</span><br><span class="line">    List&lt;Item&gt; items = tmAPI.search(lat, lon, term);</span><br><span class="line">    <span class="comment">// Save the items to the db</span></span><br><span class="line">    <span class="keyword">for</span> (Item item: items) &#123;</span><br><span class="line">        saveItem(item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>after <code>searchItem</code>, let’s try <code>saveItem</code> to save data into database. Again, careful with the import suggestions. Always choose <code>java.sql.*</code>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Save single item into db</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveItem</span><span class="params">(Item item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String sql = <span class="string">"INSERT IGNORE INTO items VALUES (?, ?, ?, ?, ?, ?, ?)"</span>;</span><br><span class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</span><br><span class="line">        <span class="comment">// Index starts from 1</span></span><br><span class="line">        stmt.setString(<span class="number">1</span>, item.getItemId());</span><br><span class="line">        stmt.setString(<span class="number">2</span>, item.getName());</span><br><span class="line">        stmt.setDouble(<span class="number">3</span>, item.getRating());</span><br><span class="line">        stmt.setString(<span class="number">4</span>, item.getAddress());</span><br><span class="line">        stmt.setString(<span class="number">5</span>, item.getImageURL());</span><br><span class="line">        stmt.setString(<span class="number">6</span>, item.getUrl());</span><br><span class="line">        stmt.setDouble(<span class="number">7</span>,  item.getDistance());</span><br><span class="line">        stmt.execute();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// set categories</span></span><br><span class="line">        sql = <span class="string">"INSERT IGNORE INTO categories VALUES(?, ?)"</span>;</span><br><span class="line">        stmt = conn.prepareStatement(sql);</span><br><span class="line">        <span class="keyword">for</span> (String category: item.getCategories()) &#123;</span><br><span class="line">            stmt.setString(<span class="number">1</span>, item.getItemId());</span><br><span class="line">            stmt.setString(<span class="number">2</span>, category);</span><br><span class="line">            stmt.execute();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Use PreparedStatement and stmt.settring() can effectively avoid SQL injection.</p>
</blockquote>
<blockquote>
<p>PreparedStatement is faster than raw String. Only have to create it once.</p>
</blockquote>
<ol start="6">
<li>SQL injection. Turns the input to the SQL statement, and makes the query always true.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// SQL injection</span></span><br><span class="line"><span class="comment">// Example:</span></span><br><span class="line"><span class="comment">// SELECT * FROM users WHERE username = '&lt;username&gt;' AND password = '&lt;password&gt;';</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// sql = "SELECT * FROM users WHERE username = '" + username + "'</span></span><br><span class="line"><span class="comment">//       AND password = '" + password + "'"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// username: aoweifjoawefijwaoeifj</span></span><br><span class="line"><span class="comment">// password: 123456' OR '1' = '1</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// SELECT * FROM users WHERE username = 'aoweifjoawefijwaoeifj' AND password = '123456' OR '1' = '1'</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>update <code>DBConnectionFactory</code>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DBConnection <span class="title">getConnection</span><span class="params">(String db)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (db) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"mysql"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MySQLConnection();</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"mongodb"</span>:</span><br><span class="line">        <span class="comment">// return new MongoDBConnection();</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid db: "</span> + db);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>In <code>src/rpc/SearchItem.java</code>, add a private <code>dbconnection</code> field and update <code>doGet()</code>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">double</span> lat = Double.parseDouble(request.getParameter(<span class="string">"lat"</span>));</span><br><span class="line">    <span class="keyword">double</span> lon = Double.parseDouble(request.getParameter(<span class="string">"lon"</span>));</span><br><span class="line">    </span><br><span class="line">    String keyword = request.getParameter(<span class="string">"term"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Connect db first then search</span></span><br><span class="line">    DBConnection conn = DBConnectionFactory.getConnection();</span><br><span class="line">    List&lt;Item&gt; items = conn.searchItems(lat, lon, keyword);</span><br><span class="line">    </span><br><span class="line">    JSONArray array = <span class="keyword">new</span> JSONArray();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Item item : items) &#123;</span><br><span class="line">            JSONObject obj = item.toJSONObject();</span><br><span class="line">            array.put(obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    RpcHelper.writeJSONArray(response, array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Implement-set-unset-favorite-related-functions"><a href="#Implement-set-unset-favorite-related-functions" class="headerlink" title="Implement set/unset favorite related functions"></a>Implement set/unset favorite related functions</h1><ol>
<li>let’s try setFavoriteItem and unsetFavoriteItem</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Operate on History table.</span></span><br><span class="line"><span class="comment">    * insert favorite information.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFavoriteItems</span><span class="params">(String userId, List&lt;String&gt; itemIds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String sql = <span class="string">"INSERT IGNORE INTO history (?, ?)"</span>;</span><br><span class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</span><br><span class="line">        <span class="keyword">for</span> (String itemId: itemIds) &#123;</span><br><span class="line">            stmt.setString(<span class="number">1</span>, userId);</span><br><span class="line">            stmt.setString(<span class="number">2</span>, itemId);</span><br><span class="line">            stmt.execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Delete favorite information</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unsetFavoriteItems</span><span class="params">(String userId, List&lt;String&gt; itemIds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String sql = <span class="string">"DELETE FROM history WHERE user_id = ? AND item_id = ?"</span>;</span><br><span class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</span><br><span class="line">        <span class="keyword">for</span> (String itemId: itemIds) &#123;</span><br><span class="line">            stmt.setString(<span class="number">1</span>, userId);</span><br><span class="line">            stmt.setString(<span class="number">2</span>, itemId);</span><br><span class="line">            stmt.execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>create a new servlet called <code>ItemHistory</code>, update the url mapping to <code>\history</code></p>
</li>
<li><p>create a new function in RpcHelper.java  to parse HTTP request body. Imagine the input HTTP request looks like:</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    user_id = “<span class="number">1111</span>”,</span><br><span class="line">    favorite = [</span><br><span class="line">        “abcd”,</span><br><span class="line">        “efgh”,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Read the http request and parse it as a JSONObject.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title">readJsonObject</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        BufferedReader reader = request.getReader();</span><br><span class="line">        String line = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sb.append(line);</span><br><span class="line">        &#125;</span><br><span class="line">        reader.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JSONObject(sb.toString());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>update <code>doPost()</code> and <code>doDelete</code> in <code>ItemHistory.java</code> to use this new function. </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Get the set favourite request and do the corresponding operation</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// get userId, itemIDs from request</span></span><br><span class="line">        JSONObject input = RpcHelper.readJsonObject(request);</span><br><span class="line">        String userId = input.getString(<span class="string">"user_id"</span>);</span><br><span class="line">        JSONArray fav_array = input.getJSONArray(<span class="string">"favorite"</span>);</span><br><span class="line">        List&lt;String&gt; itemIds = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fav_array.length(); i++) &#123;</span><br><span class="line">            itemIds.add(fav_array.get(i).toString());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// connect db and update the table</span></span><br><span class="line">        DBConnection conn = DBConnectionFactory.getConnection();</span><br><span class="line">        conn.setFavoriteItems(userId, itemIds);</span><br><span class="line">        conn.close();</span><br><span class="line">        RpcHelper.writeJSONObject(response, <span class="keyword">new</span> JSONObject().put(<span class="string">"result"</span>, <span class="string">"SUCCESS"</span>));</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Same as doPost(), but change setFavoriteItems() to unsetFavoriteItems()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDelete</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>open postman, switch to <code>post</code> method, use <a href="http://localhost:8080/Jupiter/history" target="_blank" rel="noopener">http://localhost:8080/Jupiter/history</a>, then copy the following JSON object into body. Replace <code>item_id1</code> and <code>item_id2</code> with the real <code>item_id</code> exist in your item table.</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     'user_id':'1111',</span><br><span class="line">     'favorite' : [</span><br><span class="line">         'item_id1',</span><br><span class="line">         'item_id2'</span><br><span class="line">     ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>now let’s send another request to test our delete function. Open another tab in postman, switch method to <code>delete</code>, use <a href="http://localhost:8080/Jupiter/history" target="_blank" rel="noopener">http://localhost:8080/Jupiter/history</a>, then copy the following JSON object into body. Again replace <code>item_id1</code> with the real <code>item_id</code> exist in your history table.<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     'user_id':'1111',</span><br><span class="line">     'favorite' : [</span><br><span class="line">         'item_id1',</span><br><span class="line">     ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/14/[Notes] JavaScript Basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/14/[Notes] JavaScript Basic/" class="post-title-link" itemprop="url">[Notes] JavaScript Basic</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-14 17:39:28 / Modified: 10:52:19" itemprop="dateCreated datePublished" datetime="2019-04-14T17:39:28-07:00">2019-04-14</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">8.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">7 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Linking-JavaScript-file-and-html-file"><a href="#Linking-JavaScript-file-and-html-file" class="headerlink" title="Linking JavaScript file and html file"></a>Linking JavaScript file and html file</h1><h2 id="Adding-JavaScript-into-an-HTML-Document"><a href="#Adding-JavaScript-into-an-HTML-Document" class="headerlink" title="Adding JavaScript into an HTML Document"></a>Adding JavaScript into an HTML Document</h2><p>You can add JavaScript code in an HTML document by employing the dedicated HTML tag<code>&lt;script&gt;</code> that wraps around JavaScript code.<br>The <code>&lt;script&gt;</code> tag can be placed in the <code>&lt;head&gt;</code> section of your HTML, in the <code>&lt;body&gt;</code> section, or after the <code>&lt;/body&gt;</code> close tag, depending on when you want the JavaScript to load.</p>
<h3 id="Method-1-Inline-Mode"><a href="#Method-1-Inline-Mode" class="headerlink" title="Method 1: Inline Mode"></a>Method 1: Inline Mode</h3><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-13-18-32-30.png" alt="9. JavaScript Basic-2019-4-13-18-32-30.png"></p>
<blockquote>
<p>不便于代码分离</p>
</blockquote>
<h3 id="Method-2-using-lt-script-gt-tag"><a href="#Method-2-using-lt-script-gt-tag" class="headerlink" title="Method 2: using &lt;script&gt; tag"></a>Method 2: using <code>&lt;script&gt;</code> tag</h3><p>The <code>&lt;script&gt;</code> tag can be placed in the <code>&lt;head&gt;</code> section of your HTML, in the <code>&lt;body&gt;</code> section, or after the <code>&lt;/body&gt;</code> close tag, depending on when you want the JavaScript to load.</p>
<ul>
<li>Internal Style</li>
<li>External Style</li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-13-18-38-21.png" alt="9. JavaScript Basic-2019-4-13-18-38-21.png"></li>
</ul>
<blockquote>
<p>浏览器先执行完<code>&lt;script&gt;</code>tag才会渲染其他组件</p>
</blockquote>
<h1 id="JavaScript-Fundamentals"><a href="#JavaScript-Fundamentals" class="headerlink" title="JavaScript Fundamentals"></a>JavaScript Fundamentals</h1><h2 id="variables"><a href="#variables" class="headerlink" title="variables"></a>variables</h2><ul>
<li>three ways of variable declaration:<ul>
<li>let</li>
<li>var</li>
<li>const</li>
</ul>
</li>
</ul>
<p>We use those three keywords to create variables in JavaScript. Example: <code>let message; or var message; or const message;</code></p>
<ol>
<li>var variables are defined from the beginning of the function, no matter where the definition is.</li>
<li>var has no block scope.</li>
<li>var can be declared many times, but let and const cannot in the same scope.</li>
<li>const is used to declare a constant (unchanging) variable(immutable)</li>
<li>let has only block scope, while var can be global</li>
</ol>
<h2 id="Data-Types"><a href="#Data-Types" class="headerlink" title="Data Types"></a>Data Types</h2><p>JavaScript is “dynamically typed”, meaning that there are data types, but variables are not bound to any of them.</p>
<h3 id="Date-types-Number-String-Boolean-Object-Function-Null-Undefined"><a href="#Date-types-Number-String-Boolean-Object-Function-Null-Undefined" class="headerlink" title="Date types: Number, String, Boolean, Object, Function, Null, Undefined"></a>Date types: <code>Number</code>, <code>String</code>, <code>Boolean</code>, <code>Object</code>, <code>Function</code>, <code>Null</code>, <code>Undefined</code></h3><ul>
<li><p><code>Number</code> - The number type serves both for integer and floating point numbers: 123, 12.22..</p>
<p>Note: <code>NaN</code> belong to the type number but it’s not “normal” numbers. <code>NaN</code> represents an error.</p>
</li>
<li><p><code>String</code> - A string may consist of only one character or many of them. Double and single quotes have no difference between them in JavaScript. E.g. ‘aba’, “I am a string.”</p>
</li>
<li><p><code>Boolean</code> - The boolean type has only two values: true and false.</p>
</li>
<li><p><code>Null</code> - <strong>A special value</strong> which is for unknown values. </p>
<p>In JavaScript null is not a “reference to a non-existing object” or a “null pointer” like in some other languages.<br>It’s just a special value which has the sense of “nothing”, “empty” or “value unknown”.</p>
<p>Example: <code>var age = null;</code><br>The code above states that the age is unknown or empty for some reason.</p>
</li>
<li><p><code>Undefined</code> - A special value which is for unassigned values. The meaning of undefined is “value is not assigned”.     </p>
</li>
</ul>
<blockquote>
<p>Undefined 和 null 不是数据类型，而是特殊值</p>
</blockquote>
<ul>
<li>Function and Object will cover on the following section.</li>
</ul>
<h3 id="typeof-Operator"><a href="#typeof-Operator" class="headerlink" title="typeof Operator"></a><code>typeof</code> Operator</h3><p>  returns the type of the argument. It’s useful when we want to process values of different types differently, or just want to make a quick check.<br>    e.g. <code>typeof “abc” - string</code></p>
<h3 id="Comparisons"><a href="#Comparisons" class="headerlink" title="Comparisons"></a>Comparisons</h3><p>A comparison returns a value. The value is of the boolean type: true or false.</p>
<ul>
<li>Greater/less than: <code>a &gt; b</code>, <code>a &lt; b</code>.</li>
<li>Greater/less than or equals: <code>a &gt;= b</code>, <code>a &lt;= b</code>.</li>
<li>Equality check is written as <code>a == b</code> (please note the double equation sign <code>=</code>. A single symbol <code>a = b</code> would mean an assignment).</li>
<li>Not equals. In maths the notation is <code>≠</code>, in JavaScript it’s written as an assignment with an exclamation sign before it: <code>a != b</code>.</li>
</ul>
<p>Note:<br>A regular equality check <code>==</code> has a problem. It cannot differ 0 from false:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> == <span class="literal">false</span>  <span class="comment">// true</span></span><br><span class="line">“” == <span class="literal">false</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>That’s because operands of different types are converted to a number by the equality operator <code>==</code>. An empty string, just like false, becomes a zero.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="literal">false</span>) =&gt; <span class="number">0</span>, <span class="built_in">Number</span>(“”) =&gt; <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>What to do if we’d like to differentiate 0 from false?</p>
<p>A strict equality operator <code>===</code> checks the equality without type conversion.<br>In other words, if a and b are of different types, then <code>a===b</code> immediately returns <code>false</code> without an attempt to convert them.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> === <span class="literal">false</span> <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><p>Functions are the main “building blocks” of the program. They allow the code to be called many times without repetition.</p>
<ol>
<li>Function Declaration<br><img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-14-9-38-10.png" alt="9. JavaScript Basic-2019-4-14-9-38-10.png"></li>
</ol>
<p>The function keyword goes first, then goes the name of the function, then a list of parameters between the parentheses (empty in the example above) and finally the code of the function, also named “the function body”, between curly braces.</p>
<ol start="2">
<li>Function Expression<br><img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-14-9-42-42.png" alt="9. JavaScript Basic-2019-4-14-9-42-42.png"></li>
</ol>
<p>The meaning of these code samples is the same: “create a function and put it into the variable sayHi”.</p>
<h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><ol>
<li>Objects are used to store keyed collections of various data and more complex entities. </li>
</ol>
<p>e.g. Dog object: age, name, color, breed attributes, and run() activity.</p>
<ol start="2">
<li><p>How to create an instance of object</p>
<ol>
<li><p>using new keyword </p>
<p>E.g. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> Car();</span><br><span class="line">  car.color = “red”;</span><br><span class="line">  car.type = “suv”;</span><br></pre></td></tr></table></figure>
</li>
<li><p>using literal {} 字面量<br>E.g. <code>var car = { color: ‘red’, type: ‘suv’};</code></p>
</li>
</ol>
</li>
<li><p>Use <code>.</code> or <code>[]</code> to visit attributes. </p>
<p> eg </p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t2.name; </span><br><span class="line">t2[<span class="string">'age'</span>]; </span><br><span class="line">t2[<span class="string">'run'</span>](); <span class="comment">// function call</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>example<br> <img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-14-9-49-37.png" alt="9. JavaScript Basic-2019-4-14-9-49-37.png"></p>
</li>
</ol>
<h2 id="Primitive-Type-VS-Reference-Type"><a href="#Primitive-Type-VS-Reference-Type" class="headerlink" title="Primitive Type VS. Reference Type"></a>Primitive Type VS. Reference Type</h2><ol>
<li>Numbers, Strings, Booleans, and the null and undefined types are primitive. </li>
<li>Objects, and functions are reference types.</li>
</ol>
<p>Difference: </p>
<ol>
<li><p>A primitive type has a fixed size in memory. For example, a number occupies eight bytes of memory, and a boolean value can be represented with only one bit. A reference type does not have a fixed size in memory.</p>
</li>
<li><p>Primitive types are assigned/copied “as a whole value”, but reference types are stored and copied “by reference”.</p>
</li>
</ol>
<ul>
<li><p>A variable stores not the object itself, but its “address in memory”, in other words “a reference” to it.</p>
</li>
<li><p>When an object variable is copied.the reference is copied, the object is not duplicated. </p>
</li>
</ul>
<h2 id="Pass-by-reference-and-pass-by-value"><a href="#Pass-by-reference-and-pass-by-value" class="headerlink" title="Pass by reference and pass by value"></a>Pass by reference and pass by value</h2><ol>
<li>In JavaScript primitive types are copied and passed by value and objects are copied and passed by <strong>reference</strong> value.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-14-10-5-3.png" alt="9. JavaScript Basic-2019-4-14-10-5-3.png"></p>
<ol start="2">
<li><p>In terms of function:</p>
<ol>
<li><p>In Pass by Value, function is called by directly passing the value of the variable as the argument. Changing the argument inside the function doesn’t affect the variable passed from outside the function.</p>
</li>
<li><p>In Pass by Reference, function is called by directly passing the reference/address of the variable as the argument. Changing the argument inside the function affect the variable passed from outside the function. </p>
</li>
<li><p>example<br><img src="https://raw.githubusercontent.com/Luorinz/images/master/9.%20JavaScript%20Basic-2019-4-14-10-10-25.png" alt="9. JavaScript Basic-2019-4-14-10-10-25.png"></p>
</li>
</ol>
</li>
</ol>
<p>##<br> Hoisting 变量提升</p>
<p>Hoisting is a JavaScript mechanism where variables and function declarations are moved to the top of their scope before code execution.</p>
<ol>
<li><p>Execution Context</p>
<ul>
<li>Global execution context (GEC): This is the default execution context in which JS code start it’s execution when the file first loads in the browser. </li>
<li>Functional execution context (FEC): Functional execution context is defined as the context created by the execution of code inside a function. Each function has its own execution context. </li>
</ul>
</li>
<li><p>Execution context stack </p>
<ul>
<li>Execution context stack is a stack data structure to store all the execution stacks created while executing the JS code. </li>
<li>Global execution context is present by default in execution context stack and it is at the bottom of the stack.</li>
<li>While executing global execution context code, if JS engines finds a function call, it creates functional execution context of that function and pushes that function execution context on top of execution context stack. </li>
<li>JS engine executes the function whose execution context is at the top of the execution context stack.</li>
<li>Once all the code of the function is executed, JS engines pop’s out that function’s execution context and start’s executing the function which is below it.</li>
</ul>
</li>
<li><p>JavaScript engine creates the execution context in the following two stages: <code>Creation phase</code> and <code>Execution phase</code>.</p>
</li>
</ol>
<ul>
<li><p>In creation phase, JS engine performs the following task:</p>
<ul>
<li>creates the <code>activation object</code> or the <code>variable object</code>: <code>activation object</code> is a special object in JS which contain all the variables, function arguments and inner functions declarations information. </li>
<li>creates the <code>scope chain</code>: Once the <code>activation object</code> gets created, JS engine initializes the scope chain which is a list of all the <code>variables objects</code> inside which the current function exists. This also includes the <code>variable object</code> of <code>global execution context</code>. Scope chain also contains the current <code>function variable object</code>.</li>
<li>determines the value of <code>this</code>: After the <code>scope chain</code>, JavaScript engine initialize the value of <code>‘this’</code>.</li>
</ul>
</li>
<li><p>In the execution phase, JS engines will again scan through the function to update the variable object with the values of the variables and will execute the code.</p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/13/[Notes] MySQL Basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/13/[Notes] MySQL Basic/" class="post-title-link" itemprop="url">[Notes] MySQL Basic</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-13 23:13:04" itemprop="dateCreated datePublished" datetime="2019-04-13T23:13:04-07:00">2019-04-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-16 14:26:48" itemprop="dateModified" datetime="2019-04-16T14:26:48-07:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">12k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">11 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Database-and-Database-Management-System"><a href="#Database-and-Database-Management-System" class="headerlink" title="Database and Database-Management System"></a>Database and Database-Management System</h1><h2 id="What-is-Database"><a href="#What-is-Database" class="headerlink" title="What is Database?"></a>What is Database?</h2><p>A database is an organized collection of data. </p>
<h2 id="What-is-Database-Management-System"><a href="#What-is-Database-Management-System" class="headerlink" title="What is Database-Management System?"></a>What is Database-Management System?</h2><p>A database-management system (DBMS) is a computer-software application that interacts with end-users, other applications, and the database itself to capture and analyze data. A general-purpose DBMS allows the definition, creation, querying, update, and administration of databases. </p>
<h2 id="Why-do-we-need-Database"><a href="#Why-do-we-need-Database" class="headerlink" title="Why do we need Database?"></a>Why do we need Database?</h2><p>We need to store some data set, a list of events with id, name, address, and date. What will you do? Text File? Excel?</p>
<ol>
<li>The size of list is large( &gt; 1 million users).</li>
<li>Add some constraints to some data, such as ID of each user should be different.</li>
<li>Create relations between different kind of data, such as users saved some events before.</li>
<li>Quickly retrieve data based on given condition, such as retrieve all events happened in San Francisco.</li>
<li>Quickly update or delete data based on given condition, such as update all favorite events for a given user.</li>
<li>Need access control on the data, meaning only authorized users can have access to the data set.</li>
<li>Allow multiple users access(add, search, update, delete) the data set at the same time.</li>
</ol>
<p>A DBMS allows you to fulfill all requirement above easily.</p>
<h2 id="Create-our-database-by-using-MAMP"><a href="#Create-our-database-by-using-MAMP" class="headerlink" title="Create our database by using MAMP"></a>Create our database by using MAMP</h2><p>MAMP stands for “My Apache, MySQL, and PHP”. MAMP is an integrated platform you can install on your machine which allows you to have access to a local MySQL server and its PHP server. </p>
<p>Click Preferences -&gt; Ports. Make sure Apache Port is 8888 and MySQL port is 8889. Don’t worry about the Nginx port. </p>
<p>Start Server-&gt;open phpMyAdmin-&gt;create new project myproject-&gt;use utf8_general_ci as the collation</p>
<h2 id="Relational-DBMS"><a href="#Relational-DBMS" class="headerlink" title="Relational DBMS"></a>Relational DBMS</h2><p>ER (entity-relationship) model:</p>
<ul>
<li>Entity</li>
<li>Relation: connect different entities</li>
</ul>
<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="Basic-Concepts"><a href="#Basic-Concepts" class="headerlink" title="Basic Concepts"></a>Basic Concepts</h2><ul>
<li>Table: a collection of attributions. Similar to what you’ve seen in an excel chart. Each column is an attribute of an entity, and each row is a record/instance of an entity. </li>
<li>Row: a single, implicitly structured data item in a table</li>
<li>Column: a set of data values of a particular simple type, one for each row of the table</li>
<li>Schema: blueprint of how table is constructed.</li>
</ul>
<h2 id="Project-Structure"><a href="#Project-Structure" class="headerlink" title="Project Structure"></a>Project Structure</h2><ul>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/8.%20MySQL%20Basic-2019-4-13-12-58-35.png" alt="8. MySQL Basic-2019-4-13-12-58-35.png"></li>
<li><p><code>CREATE TABLE history (item_id, user_id, ,...  FOREIGN KEY item_id REFERENCE item(item_id))</code></p>
</li>
<li><p><code>users</code> - store user information.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">User_id(primary key)</th>
<th style="text-align:center">password</th>
<th style="text-align:center">firstname</th>
<th style="text-align:center">lastname</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1111</td>
<td style="text-align:center">abcd</td>
<td style="text-align:center">Rick</td>
<td style="text-align:center">Sun</td>
</tr>
<tr>
<td style="text-align:center">2222</td>
<td style="text-align:center">efgh</td>
<td style="text-align:center">Matt</td>
<td style="text-align:center">Yan</td>
</tr>
</tbody>
</table>
<ul>
<li><code>items</code> - store item information.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">item_id(primary key)</th>
<th style="text-align:center">name</th>
<th style="text-align:center">rating</th>
<th style="text-align:center">url</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">abcd</td>
<td style="text-align:center">event1</td>
<td style="text-align:center">5</td>
<td style="text-align:center"><a href="http://www.example1.com" target="_blank" rel="noopener">www.example1.com</a></td>
</tr>
<tr>
<td style="text-align:center">efgh</td>
<td style="text-align:center">event1</td>
<td style="text-align:center">0</td>
<td style="text-align:center"><a href="http://www.example2.com" target="_blank" rel="noopener">www.example2.com</a></td>
</tr>
</tbody>
</table>
<ul>
<li><code>category</code> - store item-category relationship</li>
</ul>
<p>It’s an implementation detail, we could save category in item table, but there will be more string join/split manipulations in our code, so let’s save them in a separate table.</p>
<table>
<thead>
<tr>
<th style="text-align:center">item_id</th>
<th style="text-align:center">category</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">abcd</td>
<td style="text-align:center">party</td>
</tr>
<tr>
<td style="text-align:center">efgh</td>
<td style="text-align:center">party</td>
</tr>
<tr>
<td style="text-align:center">efgh</td>
<td style="text-align:center">sports</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Set item_id and category both as Primary Key, to map multiple items to multiple items.</p>
</blockquote>
<ul>
<li><code>history</code> - store user favorite history</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">User_id(foreign key) =&gt; user(user_id)</th>
<th style="text-align:center">item_id</th>
<th style="text-align:center">time</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1111</td>
<td style="text-align:center">abcd</td>
<td style="text-align:center">01/01/2018</td>
</tr>
<tr>
<td style="text-align:center">1111</td>
<td style="text-align:center">efgh</td>
<td style="text-align:center">01/02/2018</td>
</tr>
<tr>
<td style="text-align:center">2222</td>
<td style="text-align:center">efgh</td>
<td style="text-align:center">01/03/2018</td>
</tr>
</tbody>
</table>
<h2 id="A-few-more-concept"><a href="#A-few-more-concept" class="headerlink" title="A few more concept:"></a>A few more concept:</h2><ul>
<li><code>Unique key</code>: a key in a relational database that is unique for each record. </li>
<li><code>Primary key</code>: Also a key that is unique for each record. Cannot be NULL and used as a unique identifier.</li>
<li><code>Foreign key</code>: a key used to link two tables together. A FOREIGN KEY is a field (or collection of fields) in one table that refers to the PRIMARY KEY in another table.</li>
<li><code>Index</code>: improves the speed of data retrieval operations on a database table at the cost of additional writes and storage space to maintain the index data structure. MySQL will create index on column which is declared as key.</li>
</ul>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><ul>
<li>SEQUEL (Structured English QUEry Language)</li>
</ul>
<p>Structured Query Language is a programming language, which is used to communicate with DBMS. The standard language for relational DBMS.</p>
<h1 id="Create-tables-in-Java-program"><a href="#Create-tables-in-Java-program" class="headerlink" title="Create tables in Java program"></a>Create tables in Java program</h1><h2 id="Connect-to-database-from-our-Java-program-by-JDBC"><a href="#Connect-to-database-from-our-Java-program-by-JDBC" class="headerlink" title="Connect to database from our Java program by JDBC"></a>Connect to database from our Java program by JDBC</h2><p>Just like our Java servlet classes. JDBC provides interfaces and classes for writing database operations. Technically speaking, JDBC (Java Database Connectivity) is a standard API that defines how Java programs access database management systems. Since JDBC is a standard specification, one Java program that uses the JDBC API can connect to any database management system (DBMS), as long as a driver exists for that particular DBMS.</p>
<ul>
<li>download JDBC archive from <a href="http://dev.mysql.com/downloads/connector/j/" target="_blank" rel="noopener">http://dev.mysql.com/downloads/connector/j/</a></li>
<li>add the .jar file into your Eclipse lib. You can drag .jar file to WebContent/WEB-INF/lib directly, or copy that file and paste it (if it does not exist). </li>
<li>For DB related functions, please always use: <code>import java.sql.xxx;</code></li>
</ul>
<h2 id="Create-our-db-related-package"><a href="#Create-our-db-related-package" class="headerlink" title="Create our db related package"></a>Create our db related package</h2><ul>
<li><p>create a new package named <code>db</code>, then add a new interface called <code>DBConnection</code>. Will add support to <code>MySQL</code> and <code>MongoDB</code> later.</p>
</li>
<li><p>Add the basic function signature</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DBConnection</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Close the connection.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Insert the favorite items for a user.</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> itemIds</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFavoriteItems</span><span class="params">(String userId, List&lt;String&gt; itemIds)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Delete the favorite items for a user.</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> itemIds</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unsetFavoriteItems</span><span class="params">(String userId, List&lt;String&gt; itemIds)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Get the favorite item id for a user.</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> itemIds</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getFavoriteItemIds</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Get the favorite items for a user.</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> items</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Set&lt;Item&gt; <span class="title">getFavoriteItems</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Gets categories based on item id</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> itemId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> set of categories</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getCategories</span><span class="params">(String itemId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Search items near a geolocation and a term (optional).</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> lat</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> lon</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> term</span></span><br><span class="line"><span class="comment">  *            (Nullable)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> list of items</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">searchItems</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon, String term)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Save item into db.</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> item</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveItem</span><span class="params">(Item item)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Get full name of a user. (This is not needed for main course, just for demo</span></span><br><span class="line"><span class="comment">  * and extension).</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> full name of the user</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getFullname</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Return whether the credential is correct. (This is not needed for main</span></span><br><span class="line"><span class="comment">  * course, just for demo and extension)</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verifyLogin</span><span class="params">(String userId, String password)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a concrete class <code>DBConnectionFactory</code>, this class is used to create <code>db</code> instance</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConnectionFactory</span> </span>&#123;</span><br><span class="line">  <span class="comment">// This should change based on the pipeline.</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DB = <span class="string">"mysql"</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DBConnection <span class="title">getConnection</span><span class="params">(String db)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (db) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"mysql"</span>:</span><br><span class="line">      <span class="comment">// return new MySQLConnection();</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"mongodb"</span>:</span><br><span class="line">      <span class="comment">// return new MongoDBConnection();</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid db: "</span> + db);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DBConnection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getConnection(DEFAULT_DB);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="create-MySQL-version-of-DBConnection-implementation"><a href="#create-MySQL-version-of-DBConnection-implementation" class="headerlink" title="create MySQL version of DBConnection implementation"></a>create MySQL version of DBConnection implementation</h2><ul>
<li><p>create another package <code>db.mysql</code>, which will only contains mysql version of DBConnection implementation. Then create <code>MySQLDBUtil</code> class in <code>db.mysql</code> package.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySQLDBUtil</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HOSTNAME = <span class="string">"localhost"</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PORT_NUM = <span class="string">"8889"</span>; <span class="comment">// change it to your mysql port number</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_NAME = <span class="string">"myproject"</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String USERNAME = <span class="string">"root"</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PASSWORD = <span class="string">"root"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL = <span class="string">"jdbc:mysql://"</span></span><br><span class="line">      + HOSTNAME + <span class="string">":"</span> + PORT_NUM + <span class="string">"/"</span> + DB_NAME</span><br><span class="line">      + <span class="string">"?user="</span> + USERNAME + <span class="string">"&amp;password="</span> + PASSWORD</span><br><span class="line">      + <span class="string">"&amp;autoReconnect=true&amp;serverTimezone=UTC"</span>;</span><br><span class="line">  <span class="comment">//jdbc:mysql://localhost:8889/myproject?user=root&amp;password=root&amp;autoReconnect=true&amp;serverTimezone=UTC</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>create a new class called <code>MySQLTableCreation</code> to automatically reset our tables in our database. So in the future, you can run this function every time when you think the data stored in you DB is messed up.</p>
</li>
<li><p>first let’s try to connect to MySQL through JDBC connection. Be careful, always use java.sql.* when eclipse ask you to import DB related packages. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySQLTableCreation</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Run this as Java application to reset db schema.</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// This is java.sql.Connection. Not com.mysql.jdbc.Connection.</span></span><br><span class="line">      Connection conn = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Step 1 Connect to MySQL.</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"Connecting to "</span> + MySQLDBUtil.URL);</span><br><span class="line">        Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>).getConstructor().newInstance();</span><br><span class="line">        conn = DriverManager.getConnection(MySQLDBUtil.URL);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">"Import is done successfully."</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Question</strong>: What does this do Class.forName(“com.mysql.jdbc.Driver”).newInstance()?<br><strong>Answer</strong>: Ensure the driver is registered. We use <code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;).getConstructor().newInstance();</code> to register <code>jdbc.Driver</code> class to <code>DriverManager</code>, then create an instance of it using <code>conn = DriverManager.getConnection(MySQLDBUtil.URL);</code> </p>
<blockquote>
<p>此处为反射机制的应用</p>
</blockquote>
</li>
<li><p>after connect to MySQL, let’s try to drop old tables if they’re existed.<br>Syntax: <code>DROP TABLE IF EXISTS table_name;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step 2 Drop tables in case they exist.</span></span><br><span class="line">Statement stmt = conn.createStatement();</span><br><span class="line">String sql = <span class="string">"DROP TABLE IF EXISTS categories"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"DROP TABLE IF EXISTS history"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"DROP TABLE IF EXISTS items"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"DROP TABLE IF EXISTS users"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure>
</li>
<li><p>create 4 tables: User, Item, Category, History. Syntax: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 datatype,</span><br><span class="line">  column2 datatype,</span><br><span class="line">  column3 datatype,</span><br><span class="line">  ....</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step 3 Create new tables</span></span><br><span class="line">sql = <span class="string">"CREATE TABLE items ("</span></span><br><span class="line">    + <span class="string">"item_id VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"name VARCHAR(255),"</span></span><br><span class="line">    + <span class="string">"rating FLOAT,"</span></span><br><span class="line">    + <span class="string">"address VARCHAR(255),"</span></span><br><span class="line">    + <span class="string">"image_url VARCHAR(255),"</span></span><br><span class="line">    + <span class="string">"url VARCHAR(255),"</span></span><br><span class="line">    + <span class="string">"distance FLOAT,"</span></span><br><span class="line">    + <span class="string">"PRIMARY KEY (item_id))"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"CREATE TABLE categories ("</span></span><br><span class="line">    + <span class="string">"item_id VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"category VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"PRIMARY KEY (item_id, category),"</span></span><br><span class="line">    + <span class="string">"FOREIGN KEY (item_id) REFERENCES items(item_id))"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"CREATE TABLE users ("</span></span><br><span class="line">    + <span class="string">"user_id VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"password VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"first_name VARCHAR(255),"</span></span><br><span class="line">    + <span class="string">"last_name VARCHAR(255),"</span></span><br><span class="line">    + <span class="string">"PRIMARY KEY (user_id))"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"CREATE TABLE history ("</span></span><br><span class="line">    + <span class="string">"user_id VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"item_id VARCHAR(255) NOT NULL,"</span></span><br><span class="line">    + <span class="string">"last_favor_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,"</span></span><br><span class="line">    + <span class="string">"PRIMARY KEY (user_id, item_id),"</span></span><br><span class="line">    + <span class="string">"FOREIGN KEY (item_id) REFERENCES items(item_id),"</span></span><br><span class="line">    + <span class="string">"FOREIGN KEY (user_id) REFERENCES users(user_id))"</span>;</span><br><span class="line">stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>VarChar 指的是变长数组</p>
</blockquote>
<blockquote>
<p><code>last_favor_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP</code> 指的是如果没有给值,默认用当前时间填充</p>
</blockquote>
<blockquote>
<p><code>com.mysql.jdbc.Driver</code> is deprecated, change to <code>com.mysql.cj.jdbc.Driver</code></p>
</blockquote>
<ul>
<li><p>Add a fake user. We don’t have register function in our application, so let’s create a user in our database. Syntax: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1, column2, column3, ...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1, value2, value3, ...);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step 4: insert data</span></span><br><span class="line">sql = <span class="string">"INSERT INTO users VALUES ("</span></span><br><span class="line">    + <span class="string">"'1111', '3229c1097c00d497a0fd282d586be050', 'John', 'Smith')"</span>;</span><br><span class="line">System.out.println(<span class="string">"Executing query: "</span> + sql);</span><br><span class="line">stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/13/[Notes] CSS Basic 2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/13/[Notes] CSS Basic 2/" class="post-title-link" itemprop="url">[Notes] CSS Basic 2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-13 04:22:37" itemprop="dateCreated datePublished" datetime="2019-04-13T04:22:37-07:00">2019-04-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-12 21:23:57" itemprop="dateModified" datetime="2019-04-12T21:23:57-07:00">2019-04-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">5k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">5 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Box-Model"><a href="#Box-Model" class="headerlink" title="Box Model"></a>Box Model</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><ul>
<li>The CSS box model is essentially a box that wraps around every HTML element. It consists of: margins, borders, padding, and the actual content. </li>
</ul>
<h2 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h2><ul>
<li>Content - The content of the box, where text and images appear</li>
<li>Padding - Clears an area around the content. The padding is transparent</li>
<li>Border - A border that goes around the padding and content</li>
<li>Margin - Clears an area outside the border. The margin is transparent</li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-18-45-25.png" alt="7. CSS Basic 2-2019-4-12-18-45-25.png"></li>
</ul>
<blockquote>
<p>Every element on a page is a rectangular box.</p>
</blockquote>
<h2 id="Types-of-box-model"><a href="#Types-of-box-model" class="headerlink" title="Types of box model"></a>Types of box model</h2><p>There are actually two types of box model, one is W3C standard, the other is IE model. Basically they all calculate the element width and height based on the content width, content height, padding and border, but their formula are different:</p>
<ol>
<li><p>W3C standard</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">outer box (element space size)</span><br><span class="line">Element space width = content width + padding + border + margin</span><br><span class="line">Element space height = content height + padding + border + margin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inner box (element size)</span><br><span class="line">Element width = content width + padding + border</span><br><span class="line">Element height = content height + padding + border</span><br></pre></td></tr></table></figure>
</li>
<li><p>IE box model</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">outer box (element space size)</span><br><span class="line">Element space width = content width + margin </span><br><span class="line">Element space height = content height + margin</span><br><span class="line">(content width including padding and border)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-19-6-37.png" alt="7. CSS Basic 2-2019-4-12-19-6-37.png"></li>
<li>In order to make sure we apply the same box model to all browsers, CSS3 provides us with the new box-sizing property: <code>box-sizing: content-box || border-box || inherit</code></li>
</ul>
<h2 id="Margin-Collapsing"><a href="#Margin-Collapsing" class="headerlink" title="Margin Collapsing"></a>Margin Collapsing</h2><ul>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-19-35-16.png" alt="7. CSS Basic 2-2019-4-12-19-35-16.png"></li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-19-35-26.png" alt="7. CSS Basic 2-2019-4-12-19-35-26.png"></li>
</ul>
<h1 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h1><ul>
<li>Definition: the “display” property</li>
</ul>
<h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><ul>
<li>A block-level element starts on a new line and stretches out to the left and right as far as it can.</li>
</ul>
<h2 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h2><ul>
<li>An inline element can wrap some text inside a paragraph without disrupting the flow of that paragraph.</li>
</ul>
<h2 id="center-element"><a href="#center-element" class="headerlink" title="center element"></a>center element</h2><ul>
<li>margin: 0 auto; Centers the block elements to the center of the container.</li>
<li>text-align: center; Centers the text content.</li>
<li>display:flex; justify-content: center; Centers the items in a flex box horizontally.</li>
<li>display:flex; align-items: center; Centers the items in a flex box vertically.</li>
</ul>
<h1 id="Floating"><a href="#Floating" class="headerlink" title="Floating"></a>Floating</h1><h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><ul>
<li><p>The float CSS property specifies that an element should be placed along the left or right side of its container, allowing text and inline elements to wrap around it. The element is removed from the normal flow of the web page, though still remaining a part of the flow.</p>
</li>
<li><p>How floated elements are positioned: when an element is floated, it is taken out of the normal flow of the document (though still remaining part of it). It is shifted to the left, or right, until it touches the edge of its containing box, or another floated element.</p>
</li>
</ul>
<h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><ul>
<li><p><code>float: none|left|right|initial|inherit;</code></p>
</li>
<li><p>The float property can have one of the following values:</p>
<ul>
<li>left - The element floats to the left of its container</li>
<li>right- The element floats to the right of its container</li>
<li>none - The element does not float (will be displayed just where it occurs in the text). This is default</li>
<li>inherit - The element inherits the float value of its parent</li>
</ul>
</li>
</ul>
<h2 id="Important-Facts"><a href="#Important-Facts" class="headerlink" title="Important Facts"></a>Important Facts</h2><ol>
<li><p>float first</p>
<ul>
<li><p>When a container has multiple elements, some of them are floating, some of them are not, remember to put all the floating elements in front of the non-floating ones! Browsers try to figure out the spacing for those floating ones first.</p>
</li>
<li><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-20-18-51.png" alt="7. CSS Basic 2-2019-4-12-20-18-51.png"></p>
</li>
</ul>
</li>
<li><p>clear</p>
<ul>
<li>The clear property specifies on which sides of an element the floating elements are not allowed to float.</li>
<li><code>.clear { clear: both; /* it can be left|right|both */ }</code></li>
</ul>
</li>
<li><p>inline-block</p>
<ul>
<li><p>Floating works great, but as you see we need to apply the .clear to clear out the floating even for a block element. There is another way to achieve the floating effect, that is to use inline-block display.</p>
</li>
<li><p>similar to inline, inline-block allows multiple elements to layout on the same line, the beauty of it is that elements can automatically wrap around if the wrapper container is too small, and if you add a block element right after an inline-block element, we don’t need to use the ugly .clear fix.</p>
</li>
<li><p>可实现左右排版</p>
</li>
</ul>
</li>
</ol>
<h1 id="Position"><a href="#Position" class="headerlink" title="Position"></a>Position</h1><h2 id="static-default"><a href="#static-default" class="headerlink" title="static (default)"></a>static (default)</h2><ul>
<li>Default value, means the element is not positioned! A static element is said to be not positioned and an element with its position set to anything else is said to be positioned.</li>
</ul>
<h2 id="relative"><a href="#relative" class="headerlink" title="relative"></a>relative</h2><ul>
<li>The top, right, bottom and left properties of a relatively-positioned element will cause it to be adjusted away from its original position. Other content will not be adjusted to fit into any gap left by the element.</li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-20-47-22.png" alt="7. CSS Basic 2-2019-4-12-20-47-22.png"></li>
</ul>
<h2 id="absolute"><a href="#absolute" class="headerlink" title="absolute"></a>absolute</h2><ul>
<li>The top, right, bottom and left properties of an absolute-positioned element will cause it to be positioned relatively to the nearest positioned ancestor.</li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-20-48-9.png" alt="7. CSS Basic 2-2019-4-12-20-48-9.png"></li>
</ul>
<h2 id="fixed"><a href="#fixed" class="headerlink" title="fixed"></a>fixed</h2><ul>
<li>A fixed element is positioned relative to the viewport, which means it always stays in the same place even if the page is scrolled. </li>
</ul>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><ul>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-20-53-11.png" alt="7. CSS Basic 2-2019-4-12-20-53-11.png"></li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-20-53-25.png" alt="7. CSS Basic 2-2019-4-12-20-53-25.png"></li>
<li><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-20-53-36.png" alt="7. CSS Basic 2-2019-4-12-20-53-36.png"></p>
</li>
<li><p>Trick: 子容器绝对定位（相对于父容器）， 父容器相对定位。</p>
</li>
</ul>
<h1 id="Z-index"><a href="#Z-index" class="headerlink" title="Z-index"></a>Z-index</h1><h2 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h2><ul>
<li><p>The z-index property specifies the stack order of an element.</p>
</li>
<li><p>An element with greater stack order is always in front of an element with a lower stack order.</p>
</li>
<li>Note: z-index only works on positioned elements (position:absolute, position:relative, or position:fixed).</li>
<li><p><img src="https://raw.githubusercontent.com/Luorinz/images/master/7.%20CSS%20Basic%202-2019-4-12-21-21-49.png" alt="7. CSS Basic 2-2019-4-12-21-21-49.png"></p>
</li>
<li><p>Code <a href="http://jsbin.com/rafomem/20/edit?html,css,output" target="_blank" rel="noopener">http://jsbin.com/rafomem/20/edit?html,css,output</a></p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/12/[Notes] TicketMaster API 2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/12/[Notes] TicketMaster API 2/" class="post-title-link" itemprop="url">[Notes] TicketMaster API 2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-12 22:55:51 / Modified: 15:56:29" itemprop="dateCreated datePublished" datetime="2019-04-12T22:55:51-07:00">2019-04-12</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">7.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">7 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="TicketMaster-API-2"><a href="#TicketMaster-API-2" class="headerlink" title="TicketMaster API 2"></a>TicketMaster API 2</h1><h2 id="Benifits-of-builder-class"><a href="#Benifits-of-builder-class" class="headerlink" title="Benifits of builder class"></a>Benifits of builder class</h2><hr>
<ul>
<li>Easier to use  because you don’t need to call a constructor with long parameter list</li>
<li>Easier to implement because  you don’t need to provide constructors with different combinations of private fields.</li>
</ul>
<h2 id="TicketMasterAPI-java"><a href="#TicketMasterAPI-java" class="headerlink" title="TicketMasterAPI.java"></a>TicketMasterAPI.java</h2><hr>
<h3 id="Add-getAddress"><a href="#Add-getAddress" class="headerlink" title="Add getAddress"></a>Add getAddress</h3>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* get the Address from the JSONObject</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> A String of address</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> JSONException</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getAddress</span><span class="params">(JSONObject event)</span> <span class="keyword">throws</span> JSONException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!event.isNull(<span class="string">"_embedded"</span>)) &#123;</span><br><span class="line">    JSONObject embedded = event.getJSONObject(<span class="string">"_embedded"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!embedded.isNull(<span class="string">"venues"</span>)) &#123;</span><br><span class="line">      JSONArray venues = embedded.getJSONArray(<span class="string">"venues"</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; venues.length(); ++i) &#123;</span><br><span class="line">        JSONObject venue = venues.getJSONObject(i);</span><br><span class="line">        </span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!venue.isNull(<span class="string">"address"</span>)) &#123;</span><br><span class="line">          JSONObject address = venue.getJSONObject(<span class="string">"address"</span>);</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">if</span> (!address.isNull(<span class="string">"line1"</span>)) &#123;</span><br><span class="line">            sb.append(address.getString(<span class="string">"line1"</span>));</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!address.isNull(<span class="string">"line2"</span>)) &#123;</span><br><span class="line">            sb.append(<span class="string">" "</span>);</span><br><span class="line">            sb.append(address.getString(<span class="string">"line2"</span>));</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!address.isNull(<span class="string">"line3"</span>)) &#123;</span><br><span class="line">            sb.append(<span class="string">" "</span>);</span><br><span class="line">            sb.append(address.getString(<span class="string">"line3"</span>));</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!venue.isNull(<span class="string">"city"</span>)) &#123;</span><br><span class="line">          JSONObject city = venue.getJSONObject(<span class="string">"city"</span>);</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">if</span> (!city.isNull(<span class="string">"name"</span>)) &#123;</span><br><span class="line">            sb.append(<span class="string">" "</span>);</span><br><span class="line">            sb.append(city.getString(<span class="string">"name"</span>));</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!sb.toString().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Add-getImageURL"><a href="#Add-getImageURL" class="headerlink" title="Add getImageURL"></a>Add getImageURL</h3>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;"images": [&#123;"url": "www.example.com/my_image.jpg"&#125;, ...]&#125;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Get the image URL from a JSONOBject</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> A String of image URL</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> JSONException</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getImageUrl</span><span class="params">(JSONObject event)</span> <span class="keyword">throws</span> JSONException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!event.isNull(<span class="string">"images"</span>)) &#123;</span><br><span class="line">    JSONArray images = event.getJSONArray(<span class="string">"images"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; images.length(); ++i) &#123;</span><br><span class="line">      JSONObject image = images.getJSONObject(i);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!image.isNull(<span class="string">"url"</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> image.getString(<span class="string">"url"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Add-getCategories"><a href="#Add-getCategories" class="headerlink" title="Add getCategories"></a>Add getCategories</h3>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;"classifications" : [&#123;"segment": &#123;"name": "music"&#125;&#125;, ...]&#125;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get a set of categories from a JSONObject </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> A set of string</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> JSONException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Set&lt;String&gt; <span class="title">getCategories</span><span class="params">(JSONObject event)</span> <span class="keyword">throws</span> JSONException </span>&#123;</span><br><span class="line">	Set&lt;String&gt; categories = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	<span class="keyword">if</span> (!event.isNull(<span class="string">"classifications"</span>)) &#123;</span><br><span class="line">		JSONArray classifications = event.getJSONArray(<span class="string">"classifications"</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; classifications.length(); i++) &#123;</span><br><span class="line">			JSONObject classification = classifications.getJSONObject(i);</span><br><span class="line">			<span class="keyword">if</span> (!classification.isNull(<span class="string">"segment"</span>)) &#123;</span><br><span class="line">				JSONObject segment = classification.getJSONObject(<span class="string">"segment"</span>);</span><br><span class="line">				<span class="keyword">if</span> (!segment.isNull(<span class="string">"name"</span>)) &#123;</span><br><span class="line">					String name = segment.getString(<span class="string">"name"</span>);</span><br><span class="line">					categories.add(name);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> categories;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Add-getItemList"><a href="#Add-getItemList" class="headerlink" title="Add getItemList"></a>Add getItemList</h3>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Convert JSONArray to a list of item objects.</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Convert JSONArray to a list of item objects</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> events</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> A list of Item objects</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> JSONException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Item&gt; <span class="title">getItemList</span><span class="params">(JSONArray events)</span> <span class="keyword">throws</span> JSONException </span>&#123;</span><br><span class="line">	List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; events.length(); ++i) &#123;</span><br><span class="line">		JSONObject event = events.getJSONObject(i);</span><br><span class="line">		</span><br><span class="line">		ItemBuilder builder = <span class="keyword">new</span> ItemBuilder();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!event.isNull(<span class="string">"name"</span>)) &#123;</span><br><span class="line">			builder.setName(event.getString(<span class="string">"name"</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!event.isNull(<span class="string">"id"</span>)) &#123;</span><br><span class="line">			builder.setItemId(event.getString(<span class="string">"id"</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!event.isNull(<span class="string">"url"</span>)) &#123;</span><br><span class="line">			builder.setUrl(event.getString(<span class="string">"url"</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!event.isNull(<span class="string">"rating"</span>)) &#123;</span><br><span class="line">			builder.setRating(event.getDouble(<span class="string">"rating"</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!event.isNull(<span class="string">"distance"</span>)) &#123;</span><br><span class="line">			builder.setDistance(event.getDouble(<span class="string">"distance"</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		builder.setCategories(getCategories(event));</span><br><span class="line">		builder.setAddress(getAddress(event));</span><br><span class="line">		builder.setImageUrl(getImageUrl(event));</span><br><span class="line">		</span><br><span class="line">		itemList.add(builder.build());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> itemList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Modify-Search"><a href="#Modify-Search" class="headerlink" title="Modify Search()"></a>Modify Search()</h3>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Search the JSONArray results through TM API</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lat latitude</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lon longitude</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyword keyword is optional</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> JSONArray</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">search</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon, String keyword)</span> </span>&#123;</span><br><span class="line">	List&lt;Item&gt; ret = <span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line">	<span class="keyword">if</span> (keyword == <span class="keyword">null</span>) keyword = DEFAULT_KEYWORD;</span><br><span class="line">	<span class="comment">// translate keyword into URL-supported format</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		keyword = java.net.URLEncoder.encode(keyword, <span class="string">"UTF-8"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Get geoPoint</span></span><br><span class="line">	String geoHash = GeoHash.encodeGeohash(lat, lon, <span class="number">8</span>);</span><br><span class="line">	<span class="comment">// Create query</span></span><br><span class="line">	<span class="comment">// 50 is default search radius</span></span><br><span class="line">	String query = String.format(<span class="string">"apikey=%s&amp;geoPoint=%s&amp;keyword=%s&amp;radius=%s"</span>, API_KEY, geoHash, keyword, <span class="number">50</span>);</span><br><span class="line">	<span class="comment">// Create URL</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// create a HTTP URL connection</span></span><br><span class="line">		HttpURLConnection connection = (HttpURLConnection) <span class="keyword">new</span> URL(URL + <span class="string">"?"</span> + query).openConnection();</span><br><span class="line">		<span class="comment">// get the response code EG. 200/success, 404/fail</span></span><br><span class="line">		<span class="keyword">int</span> responseCode = connection.getResponseCode();</span><br><span class="line">		<span class="comment">// print res</span></span><br><span class="line">		System.out.println(<span class="string">"\nSending \"GET\" request to URL : "</span> + URL + <span class="string">"?"</span> + query);</span><br><span class="line">		System.out.println(<span class="string">"\nResponse Code: "</span> + responseCode);</span><br><span class="line">		<span class="comment">// check responseCode (Implement it later)</span></span><br><span class="line">		<span class="keyword">if</span> (responseCode != <span class="number">200</span>) &#123;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// read and write the response content</span></span><br><span class="line">		BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(connection.getInputStream()));</span><br><span class="line">		String inputLine;</span><br><span class="line">		StringBuilder response = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		<span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">			response.append(inputLine);</span><br><span class="line">		&#125;</span><br><span class="line">		in.close();</span><br><span class="line">		connection.disconnect();</span><br><span class="line">		<span class="comment">// write the response to a JSON object</span></span><br><span class="line">		JSONObject obj = <span class="keyword">new</span> JSONObject(response.toString());</span><br><span class="line">		<span class="comment">// check the result</span></span><br><span class="line">		<span class="keyword">if</span> (obj.isNull(<span class="string">"_embedded"</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> ret;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// get the events from the whole JSON and return the events field of it as a JSON Array.</span></span><br><span class="line">		JSONObject embedded = obj.getJSONObject(<span class="string">"_embedded"</span>);</span><br><span class="line">		JSONArray events = embedded.getJSONArray(<span class="string">"events"</span>);</span><br><span class="line">		ret = getItemList(events);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Modify-doGet-in-searchItem-Servlet"><a href="#Modify-doGet-in-searchItem-Servlet" class="headerlink" title="Modify doGet() in searchItem Servlet"></a>Modify doGet() in searchItem Servlet</h2><hr>
<pre><code class="java"><span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span>
<span class="comment"> */</span>
<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>{
    <span class="comment">// TODO Auto-generated method stub</span>

    <span class="keyword">double</span> lat = Double.parseDouble(request.getParameter(<span class="string">"lat"</span>));
    <span class="keyword">double</span> lon = Double.parseDouble(request.getParameter(<span class="string">"lon"</span>));

    String keyword = request.getParameter(<span class="string">"term"</span>);
    TicketMasterAPI tmAPI = <span class="keyword">new</span> TicketMasterAPI();
    List&lt;Item&gt; items = tmAPI.search(lat, lon, keyword);

    JSONArray array = <span class="keyword">new</span> JSONArray();
    <span class="keyword">try</span> {
        <span class="keyword">for</span> (Item item : items) {
            JSONObject obj = item.toJSONObject();
            array.put(obj);
        }
    } <span class="keyword">catch</span> (Exception e) {
        e.printStackTrace();
    }
    RpcHelper.writeJSONArray(response, array);
}
</code></pre>
<h2 id="Test-result"><a href="#Test-result" class="headerlink" title="Test result"></a>Test result</h2><ul>
<li>test on <a href="http://localhost:8080/Jupiter/search?lat=37.38&amp;lon=-122.08" target="_blank" rel="noopener">http://localhost:8080/Jupiter/search?lat=37.38&amp;lon=-122.08</a> </li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/6.%20TicketMasterAPI%202-2019-4-12-15-47-9.png" alt="6. TicketMasterAPI 2-2019-4-12-15-47-9.png"></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/11/[Notes] CSS Basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/11/[Notes] CSS Basic/" class="post-title-link" itemprop="url">[Notes] CSS Basic</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-11 03:56:16 / Modified: 11:59:49" itemprop="dateCreated datePublished" datetime="2019-04-11T03:56:16-07:00">2019-04-11</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">8.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">7 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CSS-Basic"><a href="#CSS-Basic" class="headerlink" title="CSS Basic"></a>CSS Basic</h1><h2 id="CSS-introduction"><a href="#CSS-introduction" class="headerlink" title="CSS introduction"></a>CSS introduction</h2><hr>
<ul>
<li>CSS stands for Cascading Style Sheets</li>
<li>describes how HTML elements (titles, images, paragraph…) are to be displayed on screen, paper, or in other media</li>
<li>CSS version 2.1/3.0</li>
<li>IE9 and above browsers support CSS 3.0</li>
</ul>
<h2 id="CSS-in-HTML"><a href="#CSS-in-HTML" class="headerlink" title="CSS in HTML"></a>CSS in HTML</h2><hr>
<h3 id="Usage-of-CSS-in-HTMl"><a href="#Usage-of-CSS-in-HTMl" class="headerlink" title="Usage of CSS in HTMl"></a>Usage of CSS in HTMl</h3><ul>
<li>Inline Style 内联样式 (highest priority)  <code>&lt;h1 style=&quot;color:blue;&quot;&gt;This is a heading&lt;/h1&gt;</code> (Not recommended)</li>
<li><p>Internal Style 嵌入样式 (second priority) </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">h1 &#123;</span></span><br><span class="line"><span class="undefined">      color: maroon;</span></span><br><span class="line"><span class="undefined">    &#125; </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>External Style 外部样式 (lowest priority)</p>
<ul>
<li>Each page must include a reference to the external style sheet file inside the <code>&lt;link&gt;</code> element. </li>
<li><p>The <code>&lt;link&gt;</code> element goes inside the <code>&lt;head&gt;</code> section:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"mystyle.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>type attribute: specifies the media type of the linked document </li>
<li>rel：specifies the relationship between the current document and the linked document</li>
<li>href：specifies the location of the linked document</li>
</ul>
</li>
</ul>
</li>
<li>Default Style 缺省样式</li>
<li>example <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- external style --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"mystyle.css"</span>&gt;</span>    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- internal style --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">                h1 &#123;</span></span><br><span class="line"><span class="undefined">                color: blue;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">                </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- default style --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>test0<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>test1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Inline style --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color:brown"</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h3><blockquote>
<p>Selector {Property: value; Property: value;}</p>
<ul>
<li>example <code>h1 {color:blue;font-size:12px;}</code></li>
<li>The selector  <ul>
<li>points to the HTML element you want to style.  </li>
</ul>
</li>
<li>The declaration block <ul>
<li>contains one or more declarations separated by semicolons.</li>
<li>each declaration includes a CSS property name and a value, separated by a colon.</li>
<li>always ends with a semicolon</li>
<li>declaration blocks are surrounded by curly braces.</li>
</ul>
</li>
<li>Comment <code>/* */</code></li>
</ul>
</blockquote>
<h3 id="Basic-properties"><a href="#Basic-properties" class="headerlink" title="Basic properties"></a>Basic properties</h3><ul>
<li>width - 宽度， 单位px（像素）</li>
<li>height  - 高度</li>
<li>color - 前景色， 也就是文字的颜色</li>
<li>background-color - 背景色</li>
<li>font-size - 字体的大小</li>
</ul>
<h3 id="CSS-Selectors"><a href="#CSS-Selectors" class="headerlink" title="CSS Selectors"></a>CSS Selectors</h3><ul>
<li><code>*</code>  All Elements <code>* {color:blue} /*all items set to blue*/</code></li>
<li>Element name. <code>p {color:blue} /* all p tag turn to blue */</code></li>
<li><p><code>#id</code></p>
<ul>
<li>The id selector uses the id attribute of an HTML element to select a specific element.</li>
<li>The id of an element should be unique within a page, so the id selector is used to select one unique element!</li>
<li>To select an element with a specific id, write a hash (#) character, followed by the id of the element.<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">”li-ca”</span>&gt;</span>CA<span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">#li-ca &#123;</span><br><span class="line">    color: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>class</code></p>
<ul>
<li>The class selector selects elements with a specific class attribute.</li>
<li>To select elements with a specific class, write a period (.) character, followed by the name of the class.<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.nice &#123;</span><br><span class="line">    color: purple;</span><br><span class="line">&#125;    </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"nice"</span>&gt;</span>lalala<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"nice"</span>&gt;</span>hohoho<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Combinator"><a href="#Combinator" class="headerlink" title="Combinator"></a>Combinator</h3><ul>
<li>Combinator is a selector combined by multiple selectors.</li>
<li><p>后代选择器 <code>div p</code> : selects all <code>&lt;p&gt;</code> elements inside <code>&lt;div&gt;</code> elements`</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.class h3 &#123;color:red; font-size:25px;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>并集选择器 <code>div, p</code> : selects all <code>&lt;div&gt;</code> elements and all <code>&lt;p&gt;</code> elements</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.class, h3 &#123;color:red; font-size:25px;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>子元素选择器 <code>div &gt; p</code> : selects all <code>&lt;p&gt;</code> elements where the parent is a <code>&lt;div&gt;</code> element</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.class, h3 &#123;color:red; font-size:25px;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Difference of <code>div p</code> and <code>div &gt; p</code>: <code>div p</code> includes all sons and grandsons, while <code>div &gt; p</code> has only direct sons.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- All strong whose parent is p --&gt;</span></span></span><br><span class="line"><span class="undefined">    p &gt; strong &#123;</span></span><br><span class="line"><span class="undefined">        color: red;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    p &gt; span &gt; strong &#123;</span></span><br><span class="line"><span class="undefined">        color: green;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- All strong below div --&gt;</span></span></span><br><span class="line"><span class="undefined">    div strong &#123;</span></span><br><span class="line"><span class="undefined">        font-size: 50px;</span></span><br><span class="line"><span class="undefined">    &#125;        </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span>   </span><br><span class="line"><span class="comment">&lt;!-- ...  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"aa"</span>&gt;</span>this is <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong under span<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>this is paragraph 3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>I am strong under p<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Attribute selector: Use a <code>[]</code> to select attributes</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- all p with class attribute --&gt;</span></span></span><br><span class="line"><span class="undefined">    p[class] &#123;</span></span><br><span class="line"><span class="undefined">        color:red;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- the class of p is "right --&gt;</span></span></span><br><span class="line"><span class="undefined">    p[class="right"] &#123;</span></span><br><span class="line"><span class="undefined">        color:blue;</span></span><br><span class="line"><span class="undefined">    &#125; </span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- class~="demo means class contains "demo"--&gt;</span></span></span><br><span class="line"><span class="undefined">    p[class~="demo"] &#123;</span></span><br><span class="line"><span class="undefined">        font-size: 60px;</span></span><br><span class="line"><span class="undefined">    &#125;        </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span> i am div1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> i am div2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"left demo"</span>&gt;</span> i am div3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"side"</span>&gt;</span> i am div4<span class="tag">&lt;/<span class="name">p</span>&gt;</span>        </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Pseudo Classes 伪类</p>
<ul>
<li>:link - (a:link) selects all unvisited links </li>
<li>:hover - (a:hover) selects links on mouse over</li>
<li>:active - (a:active) selects the active link</li>
<li>:visited - (a:visited) selects all visited links\</li>
<li>:first-child - (p:first-child) selects every <code>&lt;p&gt;</code> element that is the first child of its parent</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  a:link &#123;</span></span><br><span class="line"><span class="undefined">      color: red;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  a:visited &#123;</span></span><br><span class="line"><span class="undefined">      color: yellow;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  a:hover &#123;</span></span><br><span class="line"><span class="undefined">      font-size: 50px;</span></span><br><span class="line"><span class="undefined">      color: blue;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  a:active &#123;</span></span><br><span class="line"><span class="undefined">      color: green;</span></span><br><span class="line"><span class="undefined">  &#125;      </span></span><br><span class="line"><span class="undefined">  p:first-child &#123;</span></span><br><span class="line"><span class="undefined">      background-color: brown;</span></span><br><span class="line"><span class="undefined">  &#125;    </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Pesudo Elements</p>
<ul>
<li>::first-element (does not work on inline elements, such as span)<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  p::first-letter &#123;</span></span><br><span class="line"><span class="undefined">      font-size: 100px;</span></span><br><span class="line"><span class="undefined">      color: pink;</span></span><br><span class="line"><span class="undefined">  &#125;     </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="CSS-Cascade-and-Inheritance"><a href="#CSS-Cascade-and-Inheritance" class="headerlink" title="CSS Cascade and Inheritance"></a>CSS Cascade and Inheritance</h2><hr>
<h3 id="CSS-Cascade"><a href="#CSS-Cascade" class="headerlink" title="CSS Cascade"></a>CSS Cascade</h3><ul>
<li>the cascade is a set of rules for determining which style properties get applied to an element. </li>
<li>It specifies how a web browser should handle multiple styles that apply to the same tag and what to do when CSS properties conflict.</li>
<li>bottom &gt; top</li>
</ul>
<h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><ul>
<li>some property values applied to an element will be inherited by that element’s children, and some won’t.</li>
<li>font-family and color to be inherited, as that makes it easy for you to set a site-wide base font by applying a font-family to the <code>&lt;html&gt;</code> element; </li>
<li>margin, padding, border, and background-image to NOT be inherited</li>
<li><code>&lt;a&gt;</code> does not support any kind of inheritance unless: <code>a {color: inherit;}</code></li>
<li>eg. <code>&lt;span&gt;</code> inside a <code>&lt;p&gt;</code> will be overrided.</li>
</ul>
<hr>
<h2 id="Specificity"><a href="#Specificity" class="headerlink" title="Specificity"></a>Specificity</h2><hr>
<h3 id="First-Principle"><a href="#First-Principle" class="headerlink" title="First Principle"></a>First Principle</h3><ul>
<li>Inline style &gt; Internal &gt; external &gt; inheritance &gt; default</li>
</ul>
<h3 id="Second-Principle"><a href="#Second-Principle" class="headerlink" title="Second Principle"></a>Second Principle</h3><ul>
<li>id &gt; class/pseudo class &gt; tag &gt; inheritance &gt; default</li>
</ul>
<h3 id="Specificity-Collision"><a href="#Specificity-Collision" class="headerlink" title="Specificity Collision"></a>Specificity Collision</h3><ul>
<li>CSS provides a formula for determining a style’s specificity that’s based on a value assigned to the style’s selector - a tag selector, class selector, ID selector, and so on. Here’s how the system works:<ul>
<li>A tag selector is worth 1 point.</li>
<li>A class selector is worth 10 points.</li>
<li>An ID selector is worth 100 points.</li>
<li>An inline style is worth 1,000 points.</li>
<li>The bigger the number, the greater the specificity. </li>
</ul>
</li>
<li>Example<ul>
<li>A tag style for the <img> tag (specificity = 1)</li>
<li>A class style named .highlight (specificity = 10)</li>
<li>An ID style named #logo (specificity = 100)</li>
<li>Then say your web page has this HTML: <code>&lt;img id=”logo” class=”highlight” src=”logo.gif”/&gt;</code>. If you define the same property - such as the border property - in all three styles, then the value from the ID style (#logo) always wins out.</li>
</ul>
</li>
<li>A pseudo-element (like ::before) is treated like a tag selector and is worth 1 point. A pseudo-class (:link) is treated like a class and is worth 10 points.</li>
<li>Since descendant selectors are composed of several selectors - #content p, or h2 strong, for example, the math gets a bit more complicated. The specificity of a descendant selector is the total value of all of the selectors listed.</li>
<li><blockquote>
<p>A descendant selector = 1 tag + 1 tag/class</p>
</blockquote>
</li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/5.%20CSS%20Basic-2019-4-11-11-28-42.png" alt="5. CSS Basic-2019-4-11-11-28-42.png"></li>
<li>If there’s still collision, last style wins</li>
<li><code>!important;</code> This is an overruling specificity, it means ‘this is important, ignore subsequent rules, and any usual specificity issues, apply this rule!’ For example:<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">.nav a &#123; color: red; &#125;</span></span><br><span class="line"><span class="undefined">a &#123; color: blue !important; &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/09/[Notes] TicketMaster API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/09/[Notes] TicketMaster API/" class="post-title-link" itemprop="url">[Notes] TicketMaster API</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-09 23:19:53" itemprop="dateCreated datePublished" datetime="2019-04-09T23:19:53-07:00">2019-04-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-11 11:56:23" itemprop="dateModified" datetime="2019-04-11T11:56:23-07:00">2019-04-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">6.5k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">6 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="TicketMaster-API"><a href="#TicketMaster-API" class="headerlink" title="TicketMaster API"></a>TicketMaster API</h1><h2 id="HTML-request-message"><a href="#HTML-request-message" class="headerlink" title="HTML request message"></a>HTML request message</h2><ul>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/4.%20TicketMasterAPI-2019-4-11-11-26-25.png" alt="4. TicketMasterAPI-2019-4-11-11-26-25.png"></li>
<li>Request structure<ul>
<li><code>GET /doc/test.html HTTP 1.1</code><br>First part indicates the type of the request, second part indicates the resource it asks for, third part is the version of protocal</li>
<li>Request Header</li>
<li>Request Body <code>bookId=12345&amp;author=Tan+Ah+Teck</code><ul>
<li>Some browser will process the data here.<ul>
<li>Response structure</li>
</ul>
</li>
</ul>
</li>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/4.%20TicketMasterAPI-2019-4-11-11-26-38.png" alt="4. TicketMasterAPI-2019-4-11-11-26-38.png"></li>
<li>Status line <code>HTTP/1.1 200 OK</code><br>200 indicates that the response status number, and the “OK” is the explanation of the status.</li>
<li>Response Header</li>
<li>Response Body <code>&lt;h1&gt;Home page&lt;/h1&gt;</code></li>
</ul>
</li>
</ul>
<h2 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h2><ul>
<li>CRUD<ul>
<li>Create/Read/Update/Delete</li>
<li>matches HTTP POST/GET/PUT/DELETE</li>
</ul>
</li>
<li>server is stateless<ul>
<li>No need to involve other requests when handling the request.</li>
</ul>
</li>
</ul>
<h2 id="TicketMaster-API-1"><a href="#TicketMaster-API-1" class="headerlink" title="TicketMaster API"></a>TicketMaster API</h2><ul>
<li>Request<ul>
<li>URL of discover API <code>protocol://hostname:port/endpoint?query</code> :<ul>
<li>protocol: <code>https</code></li>
<li>hostname: <code>app.ticketmaster.com</code></li>
<li>endpoint: <code>/discovery/v2/events.json</code></li>
<li>query:<ul>
<li>APIkey: it’s required by TicketMaster API for <code>authn/authz</code></li>
<li>GeoPoint: <code>lat/long</code> since our search is based on client location</li>
<li>Radius: radius of search area</li>
<li>Keyword: search a specific kind of events</li>
</ul>
</li>
</ul>
</li>
<li>example <code>https://app.ticketmaster.com/discovery/v2/events.json?apikey=12345&amp;geoPoint=abcd&amp;keyword=music&amp;radius=50</code></li>
<li>Headers and Body: nothing to set since it’s not required for this API.</li>
</ul>
</li>
<li>Response<ul>
<li><img src="https://raw.githubusercontent.com/Luorinz/images/master/4.%20TicketMasterAPI-2019-4-11-11-27-25.png" alt="4. TicketMasterAPI-2019-4-11-11-27-25.png"></li>
<li>data we need is located in <code>_embedded(JSON Object) -&gt; events(JSON Array) -&gt; item object(JSON Object)</code></li>
</ul>
</li>
<li><p>Implementation</p>
<ul>
<li>Create a new Package <code>external</code> in src</li>
<li>Create a new class <code>TicketMasterAPI</code></li>
<li><p>Add some constants</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">​<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL = <span class="string">"https://app.ticketmaster.com/discovery/v2/events.json"</span>;</span><br><span class="line">​<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_KEYWORD = <span class="string">""</span>; <span class="comment">// no restriction</span></span><br><span class="line">​<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String API_KEY = <span class="string">"USE_YOUR_OWN_KEY"</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add a search function</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Search the keyword through TM API</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> lat latitude</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> lon longitude</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> keyword keyword is optional</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JSONArray <span class="title">search</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon, String keyword)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add queryAPI helper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* print the results of search(lat, lon)</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> lat latitude</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> lon longitude</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">queryAPI</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon)</span> </span>&#123;</span><br><span class="line">  JSONArray events = search(lat, lon, <span class="keyword">null</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; events.length(); i++) &#123;</span><br><span class="line">      JSONObject event = events.getJSONObject(i);</span><br><span class="line">      System.out.println(event);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add GeoHash helper to convert lat, lon to geoPoint. Copy the code from <code>http://developer-should-know.com/post/87283491372/geohash-encoding-and-decoding-algorithm</code></p>
</li>
<li><p>Implement search(lat,lon,keyword) function</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Search the JSONArray results through TM API</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> lat latitude</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> lon longitude</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> keyword keyword is optional</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> JSONArray</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JSONArray <span class="title">search</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon, String keyword)</span> </span>&#123;</span><br><span class="line">  JSONArray ret = <span class="keyword">new</span> JSONArray();</span><br><span class="line">  <span class="keyword">if</span> (keyword == <span class="keyword">null</span>) keyword = DEFAULT_KEYWORD;</span><br><span class="line">  <span class="comment">// translate keyword into URL-supported format</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    keyword = java.net.URLEncoder.encode(keyword, <span class="string">"UTF-8"</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Get geoPoint</span></span><br><span class="line">  String geoHash = GeoHash.encodeGeohash(lat, lon, <span class="number">8</span>);</span><br><span class="line">  <span class="comment">// Create query</span></span><br><span class="line">  <span class="comment">// 50 is default search radius</span></span><br><span class="line">  String query = String.format(<span class="string">"apikey=%s&amp;geoPoint=%s&amp;keyword=%s&amp;radius=%s"</span>, API_KEY, geoHash, keyword, <span class="number">50</span>);</span><br><span class="line">  <span class="comment">// Create URL</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// create a HTTP URL connection</span></span><br><span class="line">    HttpURLConnection connection = (HttpURLConnection) <span class="keyword">new</span> URL(URL + <span class="string">"?"</span> + query).openConnection();</span><br><span class="line">    <span class="comment">// get the response code EG. 200/success, 404/fail</span></span><br><span class="line">    <span class="keyword">int</span> responseCode = connection.getResponseCode();</span><br><span class="line">    <span class="comment">// print res</span></span><br><span class="line">    System.out.println(<span class="string">"\nSending \"GET\" request to URL : "</span> + URL + <span class="string">"?"</span> + query);</span><br><span class="line">    System.out.println(<span class="string">"\nResponse Code: "</span> + responseCode);</span><br><span class="line">    <span class="comment">// check responseCode (Implement it later)</span></span><br><span class="line">    <span class="keyword">if</span> (responseCode != <span class="number">200</span>) &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// read and write the response content</span></span><br><span class="line">    BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(connection.getInputStream()));</span><br><span class="line">    String inputLine;</span><br><span class="line">    StringBuilder response = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">      response.append(inputLine);</span><br><span class="line">    &#125;</span><br><span class="line">    in.close();</span><br><span class="line">    connection.disconnect();</span><br><span class="line">    <span class="comment">// write the response to a JSON object</span></span><br><span class="line">    JSONObject obj = <span class="keyword">new</span> JSONObject(response.toString());</span><br><span class="line">    <span class="comment">// check the result</span></span><br><span class="line">    <span class="keyword">if</span> (obj.isNull(<span class="string">"_embedded"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// get the events from the whole JSON and return the events field of it as a JSON Array.</span></span><br><span class="line">    JSONObject embedded = obj.getJSONObject(<span class="string">"_embedded"</span>);</span><br><span class="line">    JSONArray events = embedded.getJSONArray(<span class="string">"events"</span>);</span><br><span class="line">    ret = events;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a new package <code>entity</code> and a new class <code>Item</code>(entity表示servelet储存数据的类)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Item of event</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> andaluo</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String itemId;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> rating;</span><br><span class="line">  <span class="keyword">private</span> String address;</span><br><span class="line">  <span class="keyword">private</span> Set&lt;String&gt; categories;</span><br><span class="line">  <span class="keyword">private</span> String imageURL;</span><br><span class="line">  <span class="keyword">private</span> String url;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> distance;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> JSONObject <span class="title">toJSONObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    JSONObject obj = <span class="keyword">new</span> JSONObject();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      obj.put(<span class="string">"item_id"</span>, itemId);</span><br><span class="line">      obj.put(<span class="string">"name"</span>, name);	</span><br><span class="line">      obj.put(<span class="string">"rating"</span>, rating);</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Use builder pattern to create Item class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * A helper class to build the Item class</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@author</span> andaluo</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemBuilder</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String itemId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Construct the Item using builder</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Item(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * return the builder itself to support continuous operation.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> itemId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ItemBuilder <span class="title">setItemId</span><span class="params">(String itemId)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.itemId = itemId;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Builder pattern to create a class</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(ItemBuilder builder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.itemId = builder.itemId;</span><br><span class="line">    <span class="keyword">this</span>.name = builder.name;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// when build the item we get</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Item item = <span class="keyword">new</span> Item.ItemBuilder().setAddress(<span class="string">"abc"</span>).setDistance(<span class="number">19</span>).build();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/09/How to Reverse A Linked List/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Anda Luo">
      <meta itemprop="description" content="Notes of study, work and life">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Anda">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/09/How to Reverse A Linked List/" class="post-title-link" itemprop="url">How to Reverse A Linked List</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-09 17:04:54 / Modified: 10:09:05" itemprop="dateCreated datePublished" datetime="2019-04-09T17:04:54-07:00">2019-04-09</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">780</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">1 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Reverse-linked-list"><a href="#Reverse-linked-list" class="headerlink" title="Reverse linked list"></a>Reverse linked list</h1><ol>
<li><p>corner case</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dummy-&gt;1-&gt;null</span><br><span class="line">dummy-&gt;null</span><br></pre></td></tr></table></figure>
</li>
<li><p>general case</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dummy-&gt; 1 -&gt;   2      -&gt; 3 -&gt; null</span><br><span class="line">pre    cur  nextNode</span><br><span class="line"></span><br><span class="line">dummy -&gt;  2   -&gt; 1 -&gt; 3 -&gt; null</span><br><span class="line">pre     nextNode cur  </span><br><span class="line"></span><br><span class="line">dummy -&gt;  2   -&gt; 1 -&gt;   3   -&gt; null</span><br><span class="line">pre             cur  nextNode</span><br><span class="line"></span><br><span class="line">dummy -&gt;  3   -&gt; 2 -&gt;   1   -&gt; null</span><br><span class="line">pre                    cur      nextNode</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol>
<li>link cur to the next node <code>cur.next = nextNode.next</code></li>
<li>link nextNode to the head of the reversed part <code>nextNode.next = pre.next</code></li>
<li>link pre to the nextNode <code>pre.next = nextNode</code></li>
<li>update nextNode to next <code>nextNode = cur.next</code></li>
<li>when nextNode gets to the end, exit</li>
</ol>
<hr>
<blockquote>
<p>cur represents the tail, and pre represents the the dummy, nextNode represents the node waiting to be added to the head of the list.</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Anda Luo</p>
              <div class="site-description motion-element" itemprop="description">Notes of study, work and life</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Luorinz" title="GitHub &rarr; https://github.com/Luorinz" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:luorinz@gmail.com" title="E-Mail &rarr; mailto:luorinz@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  
    <div id="sidebar-dimmer"></div>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Anda Luo</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total">202k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Reading time total">3:04</span>
  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  



  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>











  



  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>

  
  <script src="/lib/reading_progress/reading_progress.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  

</body>
</html>
